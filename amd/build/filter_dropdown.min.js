define("mod_bookit/filter_dropdown",["exports","jquery"],(function(_exports,_jquery){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.init=()=>{const root=document.querySelector(".bookit-filterdropdown");if(!root)return;const roomId=root.getAttribute("data-room-select"),facultyId=root.getAttribute("data-faculty-select"),statusId=root.getAttribute("data-status-select"),selectRoom=document.getElementById(roomId),selectFaculty=document.getElementById(facultyId),selectStatus=document.getElementById(statusId);if(!selectRoom||!selectFaculty||!selectStatus)return void console.warn("[BookIT] filter_dropdown: Missing select(s)",{roomId:roomId,facultyId:facultyId,statusId:statusId});const $toggle=(0,_jquery.default)(root).find(".bookit-filterdropdown-toggle"),$panel=(0,_jquery.default)(root).find(".bookit-filterdropdown-panel"),$cats=(0,_jquery.default)(root).find(".bookit-filterdropdown-categories"),$opts=(0,_jquery.default)(root).find(".bookit-filterdropdown-options"),$chipsInButton=(0,_jquery.default)(root).find(".bookit-filterdropdown-chips"),$chipsInPanel=(0,_jquery.default)(root).find(".bookit-filterdropdown-activechips"),canStatus="1"===root.getAttribute("data-can-status"),model=[{key:"room",select:selectRoom},{key:"faculty",select:selectFaculty}];canStatus&&model.push({key:"status",select:selectStatus});const isOpen=()=>!$panel.prop("hidden"),close=()=>{$panel.prop("hidden",!0),$toggle.attr("aria-expanded","false"),$opts.empty(),$cats.find(".active").removeClass("active")},setValueAndTrigger=(sel,value)=>{sel.value=value,sel.dispatchEvent(new Event("change",{bubbles:!0})),(0,_jquery.default)(sel).trigger("change")},renderChips=()=>{const chips=[];model.forEach((_ref=>{let{key:key,select:select}=_ref;const label=(sel=>{const idx=sel.selectedIndex;if(idx<0)return"";const opt=sel.options[idx];return opt&&""!==opt.value&&opt.textContent||""})(select);label&&chips.push({key:key,label:label})}));const html=chips.map((chip=>'\n            <span class="bookit-filterchip" data-key="'.concat(chip.key,'">\n                <span class="bookit-filterchip-label">').concat(escapeHtml(chip.label),'</span>\n                <button type="button" class="bookit-filterchip-remove" aria-label="Remove filter">Ã—</button>\n            </span>\n        '))).join("");$chipsInButton.html(html),$chipsInPanel.html(html)};$toggle.on("click",(e=>{e.preventDefault(),isOpen()?close():($panel.prop("hidden",!1),$toggle.attr("aria-expanded","true"))})),(0,_jquery.default)(document).on("mousedown.bookitFilterDropdown",(e=>{isOpen()&&!root.contains(e.target)&&close()})),(0,_jquery.default)(document).on("keydown.bookitFilterDropdown",(e=>{isOpen()&&"Escape"===e.key&&close()})),$cats.on("click",".bookit-filtercat",(function(e){e.preventDefault();const key=(0,_jquery.default)(this).data("key");$cats.find(".active").removeClass("active"),(0,_jquery.default)(this).addClass("active"),(key=>{const item=model.find((x=>x.key===key));if(!item)return;const sel=item.select;$opts.empty();const options=Array.from(sel.options).filter((o=>""!==o.value));options.length?options.forEach((o=>{const active=sel.value===o.value?" active":"";$opts.append('\n                <button type="button"\n                        class="bookit-filteropt'.concat(active,'"\n                        data-key="').concat(key,'"\n                        data-value="').concat(escapeAttr(o.value),'">\n                    ').concat(escapeHtml(o.textContent||""),"\n                </button>\n            "))})):$opts.html('<div class="bookit-filteropt-empty">No options</div>')})(key)})),$opts.on("click",".bookit-filteropt",(function(e){e.preventDefault();const key=String(this.getAttribute("data-key")||""),value=String(this.getAttribute("data-value")||""),item=model.find((x=>x.key===key));item?(setValueAndTrigger(item.select,value),renderChips(),close()):console.warn("[BookIT] filter_dropdown: unknown key for option click",key)})),(0,_jquery.default)(root).on("click",".bookit-filterchip-remove",(function(e){e.preventDefault(),e.stopPropagation();const key=(0,_jquery.default)(this).closest(".bookit-filterchip").data("key"),item=model.find((x=>x.key===key));item&&(setValueAndTrigger(item.select,""),renderChips())})),(0,_jquery.default)(selectRoom).on("change",renderChips),(0,_jquery.default)(selectFaculty).on("change",renderChips),(0,_jquery.default)(selectStatus).on("change",renderChips),$cats.empty(),model.forEach((_ref2=>{let{key:key,select:select}=_ref2;const label=select.options[0]&&select.options[0].textContent?select.options[0].textContent:key;$cats.append('\n                <button type="button" class="bookit-filtercat" data-key="'.concat(key,'">\n                    ').concat(escapeHtml(label),"\n                </button>\n            "))})),renderChips(),console.log("[BookIT] filter_dropdown initialized (frontend-only)")};const escapeHtml=s=>String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"),escapeAttr=s=>escapeHtml(s)}));

//# sourceMappingURL=filter_dropdown.min.js.map