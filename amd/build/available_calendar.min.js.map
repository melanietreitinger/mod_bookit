{"version":3,"file":"available_calendar.min.js","sources":["../src/available_calendar.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Manage the calendar\r\n *\r\n * @module     mod_bookit/available_calendar\r\n * @copyright  2024 Melanie Treitinger, Justus Dieckmann RUB\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport * as Ajax from 'core/ajax';\r\nimport {getString} from 'core/str';\r\nimport ModalEvents from 'core/modal_events';\r\nimport ModalForm from 'core_form/modalform';\r\nimport {prefetchStrings} from 'core/prefetch';\r\nimport {theGlobalProperty} from \"mod_bookit/calendar\";\r\n\r\n/**\r\n * Initializes the calendar.\r\n * @param {string} eventsource\r\n * @param {array} capabilities\r\n * @param {string} lang\r\n * @returns {Promise<void>}\r\n */\r\nexport async function init(eventsource, capabilities, lang) {\r\n    await theGlobalProperty('EventCalendar');\r\n\r\n    // Define toolbarbuttons.\r\n    const toolbarbuttons = 'prev, next, today, addButton';\r\n\r\n    // String variables.\r\n    prefetchStrings('mod_bookit', ['add_blocker']);\r\n    prefetchStrings('core', ['today', 'month', 'week']);\r\n    prefetchStrings('calendar', ['day', 'upcomingevents']);\r\n    const str_request_booking = await getString('add_blocker', 'mod_bookit');\r\n    const str_today = await getString('today');\r\n    const str_month = await getString('month');\r\n    const str_week = await getString('week');\r\n    const str_day = await getString('day', 'calendar');\r\n    const str_list = await getString('upcomingevents', 'calendar');\r\n\r\n    // Define viewtype.\r\n    let viewType = 'timeGridWeek';\r\n    if (window.screen.width <= 1000) {\r\n        viewType = 'listWeek';\r\n    }\r\n\r\n    var calendar;\r\n\r\n    calendar = new window.EventCalendar(document.getElementById('ec'), {\r\n        locale: lang,\r\n        view: viewType,\r\n        firstDay: 1,\r\n        scrollTime: '09:00:00',\r\n        slotMinTime: '07:00:00',\r\n        dayMaxEvents: true,\r\n        nowIndicator: true,\r\n        selectable: false,\r\n        eventBackgroundColor: '#035AA3',\r\n        eventStartEditable: false,\r\n        eventDurationEditable: false,\r\n        buttonText: function(text) {\r\n            text.today = str_today;\r\n            text.dayGridMonth = str_month;\r\n            text.timeGridWeek = str_week;\r\n            text.timeGridDay = str_day;\r\n            text.listWeek = str_list;\r\n            return text;\r\n        },\r\n        customButtons: {\r\n            addButton: {\r\n                text: str_request_booking,\r\n                click: function() {\r\n                    const modalForm = new ModalForm({\r\n                        formClass: \"mod_bookit\\\\local\\\\form\\\\edit_blocker_form\",\r\n                        args: {\r\n                        },\r\n                        modalConfig: {title: getString('add_blocker', 'mod_bookit')},\r\n                    });\r\n                    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\r\n                        calendar.refetchEvents();\r\n                    });\r\n                    modalForm.show();\r\n                }\r\n            }\r\n        },\r\n        dateClick: function(info) {\r\n            let d = new Date();\r\n            let dateoff = new Date(d.setMinutes(d.getMinutes() - d.getTimezoneOffset()));\r\n            let startdate = info.dateStr;\r\n            if (startdate > dateoff.toISOString()) {\r\n                const modalForm = new ModalForm({\r\n                    formClass: \"mod_bookit\\\\local\\\\form\\\\edit_blocker_form\",\r\n                    args: {\r\n                        startdate: startdate,\r\n                    },\r\n                    modalConfig: {title: getString('add_blocker', 'mod_bookit')},\r\n                });\r\n                modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\r\n                    calendar.refetchEvents();\r\n                });\r\n                modalForm.show();\r\n            }\r\n        },\r\n        eventClick: function(info) {\r\n            if (info.event.extendedProps.type === 'blocker') {\r\n                const modalForm = new ModalForm({\r\n                    formClass: \"mod_bookit\\\\local\\\\form\\\\edit_blocker_form\",\r\n                    args: {\r\n                        id: info.event.id,\r\n                    },\r\n                    modalConfig: {\r\n                        title: getString('edit_blocker', 'mod_bookit'),\r\n                    },\r\n                    moduleName: 'mod_bookit/modal_delete_save_cancel',\r\n                });\r\n                modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\r\n                    calendar.refetchEvents();\r\n                });\r\n                modalForm.addEventListener(modalForm.events.LOADED, () => {\r\n                    modalForm.modal.getRoot().on(ModalEvents.delete, async() => {\r\n                        await deleteBlocker(info.event.id);\r\n                        calendar.refetchEvents();\r\n                    });\r\n                });\r\n                modalForm.show();\r\n            }\r\n        },\r\n        headerToolbar: {\r\n            start: toolbarbuttons,\r\n            center: 'title',\r\n            end: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'\r\n        },\r\n        resources: [],\r\n        eventSources: [\r\n            {\r\n                url: eventsource,\r\n            },\r\n        ],\r\n        views: {\r\n            timeGridWeek: {pointer: true},\r\n            resourceTimeGridWeek: {pointer: true},\r\n            resourceTimelineWeek: {\r\n                pointer: true,\r\n                slotMinTime: '09:00',\r\n                slotMaxTime: '21:00',\r\n                slotWidth: 80,\r\n                resources: []\r\n            }\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Deletes a blocker.\r\n *\r\n * @param {int} blockerId\r\n * @returns Promise<any>\r\n */\r\nfunction deleteBlocker(blockerId) {\r\n    return Ajax.call([{\r\n        methodname: 'mod_bookit_delete_blocker',\r\n        args: {\r\n            blockerid: blockerId\r\n        }\r\n    }])[0];\r\n}\r\n"],"names":["eventsource","capabilities","lang","str_request_booking","str_today","str_month","str_week","str_day","str_list","viewType","window","screen","width","calendar","EventCalendar","document","getElementById","locale","view","firstDay","scrollTime","slotMinTime","dayMaxEvents","nowIndicator","selectable","eventBackgroundColor","eventStartEditable","eventDurationEditable","buttonText","text","today","dayGridMonth","timeGridWeek","timeGridDay","listWeek","customButtons","addButton","click","modalForm","ModalForm","formClass","args","modalConfig","title","addEventListener","events","FORM_SUBMITTED","refetchEvents","show","dateClick","info","d","Date","dateoff","setMinutes","getMinutes","getTimezoneOffset","startdate","dateStr","toISOString","eventClick","event","extendedProps","type","id","moduleName","LOADED","modal","getRoot","on","ModalEvents","delete","async","blockerId","Ajax","call","methodname","blockerid","headerToolbar","start","center","end","resources","eventSources","url","views","pointer","resourceTimeGridWeek","resourceTimelineWeek","slotMaxTime","slotWidth"],"mappings":";;;;;;;;eAqC2BA,YAAaC,aAAcC,YAC5C,+BAAkB,+CAMR,aAAc,CAAC,8CACf,OAAQ,CAAC,QAAS,QAAS,uCAC3B,WAAY,CAAC,MAAO,yBAC9BC,0BAA4B,kBAAU,cAAe,cACrDC,gBAAkB,kBAAU,SAC5BC,gBAAkB,kBAAU,SAC5BC,eAAiB,kBAAU,QAC3BC,cAAgB,kBAAU,MAAO,YACjCC,eAAiB,kBAAU,iBAAkB,gBAG/CC,SAAW,eACXC,OAAOC,OAAOC,OAAS,MACvBH,SAAW,gBAGXI,SAEJA,SAAW,IAAIH,OAAOI,cAAcC,SAASC,eAAe,MAAO,CAC/DC,OAAQf,KACRgB,KAAMT,SACNU,SAAU,EACVC,WAAY,WACZC,YAAa,WACbC,cAAc,EACdC,cAAc,EACdC,YAAY,EACZC,qBAAsB,UACtBC,oBAAoB,EACpBC,uBAAuB,EACvBC,WAAY,SAASC,aACjBA,KAAKC,MAAQ1B,UACbyB,KAAKE,aAAe1B,UACpBwB,KAAKG,aAAe1B,SACpBuB,KAAKI,YAAc1B,QACnBsB,KAAKK,SAAW1B,SACTqB,MAEXM,cAAe,CACXC,UAAW,CACPP,KAAM1B,oBACNkC,MAAO,iBACGC,UAAY,IAAIC,mBAAU,CAC5BC,UAAW,6CACXC,KAAM,GAENC,YAAa,CAACC,OAAO,kBAAU,cAAe,iBAElDL,UAAUM,iBAAiBN,UAAUO,OAAOC,gBAAgB,KACxDjC,SAASkC,mBAEbT,UAAUU,UAItBC,UAAW,SAASC,UACZC,EAAI,IAAIC,KACRC,QAAU,IAAID,KAAKD,EAAEG,WAAWH,EAAEI,aAAeJ,EAAEK,sBACnDC,UAAYP,KAAKQ,WACjBD,UAAYJ,QAAQM,cAAe,OAC7BrB,UAAY,IAAIC,mBAAU,CAC5BC,UAAW,6CACXC,KAAM,CACFgB,UAAWA,WAEff,YAAa,CAACC,OAAO,kBAAU,cAAe,iBAElDL,UAAUM,iBAAiBN,UAAUO,OAAOC,gBAAgB,KACxDjC,SAASkC,mBAEbT,UAAUU,SAGlBY,WAAY,SAASV,SACqB,YAAlCA,KAAKW,MAAMC,cAAcC,KAAoB,OACvCzB,UAAY,IAAIC,mBAAU,CAC5BC,UAAW,6CACXC,KAAM,CACFuB,GAAId,KAAKW,MAAMG,IAEnBtB,YAAa,CACTC,OAAO,kBAAU,eAAgB,eAErCsB,WAAY,wCAEhB3B,UAAUM,iBAAiBN,UAAUO,OAAOC,gBAAgB,KACxDjC,SAASkC,mBAEbT,UAAUM,iBAAiBN,UAAUO,OAAOqB,QAAQ,KAChD5B,UAAU6B,MAAMC,UAAUC,GAAGC,sBAAYC,QAAQC,cAuC9CC,gBAAAA,UAtCqBvB,KAAKW,MAAMG,GAuC5CU,KAAKC,KAAK,CAAC,CACdC,WAAY,4BACZnC,KAAM,CACFoC,UAAWJ,cAEf,IA3CgB5D,SAASkC,sBAGjBT,UAAUU,SAGlB8B,cAAe,CACXC,MArGe,+BAsGfC,OAAQ,QACRC,IAAK,kDAETC,UAAW,GACXC,aAAc,CACV,CACIC,IAAKpF,cAGbqF,MAAO,CACHrD,aAAc,CAACsD,SAAS,GACxBC,qBAAsB,CAACD,SAAS,GAChCE,qBAAsB,CAClBF,SAAS,EACTjE,YAAa,QACboE,YAAa,QACbC,UAAW,GACXR,UAAW"}