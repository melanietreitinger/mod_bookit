{"version":3,"file":"master_checklist.min.js","sources":["../src/master_checklist.js"],"sourcesContent":["import {BaseComponent} from 'core/reactive';\nimport {masterChecklistReactiveInstance} from 'mod_bookit/master_checklist_reactive';\nimport {SELECTORS} from 'mod_bookit/master_checklist_reactive';\nimport ModalForm from 'core_form/modalform';\nimport Templates from 'core/templates';\nimport * as Toast from 'core/toast';\nimport {getString} from 'core/str';\nimport ChecklistHelper from 'mod_bookit/checklist_helper';\nimport html2pdf from 'mod_bookit/html2pdf.bundle';\n\nexport default class extends BaseComponent {\n\n    static getEvents() {\n        return {\n            categoryRendered: 'mod_bookit:master_checklist_category_rendered',\n        };\n    }\n\n    static init(target, selectors) {\n        return new this({\n            element: document.querySelector(target),\n            reactive: masterChecklistReactiveInstance,\n            selectors: selectors || SELECTORS,\n        });\n    }\n\n    create() {\n        this.helper = new ChecklistHelper();\n    }\n\n    getWatchers() {\n        return [\n            {watch: 'checklistcategories:created', handler: this._handleCategoryCreatedEvent},\n            {watch: 'checklistcategories:deleted', handler: this._handleCategoryDeletedEvent},\n            {watch: 'checklistcategories.name:updated', handler: this._handleCategoryNameUpdatedEvent},\n\n            {watch: 'checklistitems:created', handler: this._handleItemCreatedEvent},\n            {watch: 'checklistitems:deleted', handler: this._handleItemDeletedEvent},\n            // {watch: 'checklistitems.categoryid:updated', handler: this._handleItemCategoryUpdatedEvent},\n            {watch: 'checklistitems.title:updated', handler: this._replaceRenderedItem},\n            {watch: 'checklistitems.roomids:updated', handler: this._replaceRenderedItem},\n            {watch: 'checklistitems.roleids:updated', handler: this._replaceRenderedItem},\n            // {watch: 'activeRole:updated', handler: this._handleRoleUpdate},\n            // {watch: 'activeRoom:updated', handler: this._handleRoomUpdate},\n            {watch: 'activeRoom:created', handler: this._handleFilterUpdate},\n        ];\n    }\n\n    stateReady(state) {\n\n        const name = state.masterchecklists.get(1).name;\n\n        const titleElement = this.getElement(this.selectors.MASTER_CHECKLIST_TITLE);\n\n        titleElement.innerHTML = name;\n\n        this.addEventListener(this.getElement(this.selectors.ADD_CHECKLIST_ITEM_BUTTON), 'click', (e) => {\n            e.preventDefault();\n            this._handleAddChecklistItemButtonClick(e);\n        });\n\n        this.addEventListener(this.getElement(this.selectors.ADD_CHECKLIST_CATEGORY_BUTTON), 'click', (e) => {\n            e.preventDefault();\n            this._handleAddChecklistCategoryButtonClick(e);\n        });\n\n        this.addEventListener(this.getElement(this.selectors.ROLE_SELECT), 'change', (e) => {\n            this.reactive.dispatch('roleChanged', {id: e.target.value});\n        });\n        this.addEventListener(this.getElement(this.selectors.ROOM_SELECT), 'change', (e) => {\n\n            window.console.log('ROOM SELECT CHANGED: ', e);\n\n            // TODO we need to dispatch all selected values\n\n            this.reactive.dispatch('roomChanged', {options: e.target.selectedOptions});\n        });\n\n        // Add event listener for export button\n        this.addEventListener(this.getElement(this.selectors.EXPORT_BTN), 'click', (e) => {\n            e.preventDefault();\n            this._handleExportChecklistButtonClick(e);\n        });\n\n        // Add event listener for import button\n        this.addEventListener(this.getElement(this.selectors.IMPORT_BTN), 'click', (e) => {\n            e.preventDefault();\n            this._handleImportChecklistButtonClick(e);\n        });\n\n        const spinnerElement = document.querySelector(this.selectors.LOADING_SPINNER);\n        spinnerElement.classList.add('d-none');\n\n        const mainElement = document.querySelector(this.selectors.MAIN_ELEMENT);\n        mainElement.classList.remove('d-none');\n        mainElement.classList.add('d-flex');\n\n    }\n\n    _handleFilterUpdate(event) {\n        window.console.log('Filter update in master checklist:', event);\n\n        // Check if the created element has id 0 (No selection)\n        if (event.element.id === \"0\") {\n            window.console.log('No selection detected - clearing other room selections');\n\n            const roomSelect = this.getElement(this.selectors.ROOM_SELECT);\n\n            // Unselect all options except the one with value \"0\"\n            for (let option of roomSelect.options) {\n                if (option.value !== \"0\") {\n                    option.selected = false;\n                } else {\n                    option.selected = true;\n                }\n            }\n        }\n    }\n\n    async _handleAddChecklistItemButtonClick() {\n        const modalForm = new ModalForm({\n            formClass: \"mod_bookit\\\\form\\\\edit_checklist_item_form\",\n            args: {\n                masterid: 1,\n                itemid: null,\n                categories: Array.from(this.reactive.state.checklistcategories.values()),\n            },\n            modalConfig: {\n                title: await getString('checklistitem', 'mod_bookit'),\n            },\n\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.dispatch('checklistitemCreated', response.detail);\n        });\n\n        modalForm.show();\n    }\n\n\n    async _handleAddChecklistCategoryButtonClick() {\n        const modalForm = new ModalForm({\n            formClass: \"mod_bookit\\\\form\\\\edit_checklist_category_form\",\n            args: {\n                masterid: 1\n            },\n            modalConfig: {\n                title: await getString('checklistcategory', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n\n        });\n\n        modalForm.show();\n    }\n\n    async _handleExportChecklistButtonClick(e) {\n        const masterid = e.target.dataset.masterId;\n\n        const modalForm = new ModalForm({\n            formClass: \"mod_bookit\\\\form\\\\export_checklist_form\",\n            args: {\n                masterid: masterid\n            },\n            modalConfig: {\n                title: await getString('export', 'mod_bookit'),\n            },\n            saveButtonText: await getString('export', 'mod_bookit'),\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, async (response) => {\n            if (response.detail.success) {\n                // Check if this is HTML-based PDF export or server-side export\n                if (response.detail.method === 'html') {\n                    // Client-side HTML2PDF export\n                    window.console.log('Starting HTML2PDF export...');\n                    window.console.log('MAIN_ELEMENT selector:', this.selectors.MAIN_ELEMENT);\n\n                    var element = document.querySelector(this.selectors.MAIN_ELEMENT);\n                    window.console.log('Selected element:', element);\n\n                    if (!element) {\n                        window.console.error('Element not found with selector:', this.selectors.MAIN_ELEMENT);\n                        Toast.add('Export failed: Element not found', {type: 'error'});\n                        return;\n                    }\n\n                    window.console.log('Element content length:', element.innerHTML.length);\n                    window.console.log('html2pdf function:', typeof html2pdf, html2pdf);\n                    window.console.log('Calling html2pdf...');\n\n                    try {\n                        // Generate timestamp for filename\n                        const now = new Date();\n                        const timestamp = now.getFullYear() +\n                            String(now.getMonth() + 1).padStart(2, '0') +\n                            String(now.getDate()).padStart(2, '0') + '_' +\n                            String(now.getHours()).padStart(2, '0') +\n                            String(now.getMinutes()).padStart(2, '0') +\n                            String(now.getSeconds()).padStart(2, '0');\n\n                        // Configure html2pdf options for better output\n                        const options = {\n                            margin: 1,\n                            filename: `master-checklist_${timestamp}.pdf`,\n                            image: { type: 'jpeg', quality: 0.98 },\n                            html2canvas: { scale: 2, useCORS: true },\n                            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }\n                        };\n\n                        window.console.log('Using html2pdf options:', options);\n\n                        const result = html2pdf(element, options);\n                        window.console.log('html2pdf result:', result);\n\n                        // html2pdf returns a promise, so we need to handle it\n                        if (result && typeof result.then === 'function') {\n                            result.then(() => {\n                                window.console.log('PDF export completed successfully');\n                                Toast.add(getString('export_success', 'mod_bookit'), {type: 'success'});\n                            }).catch((error) => {\n                                window.console.error('PDF export failed:', error);\n                                Toast.add('Export failed: ' + error.message, {type: 'error'});\n                            });\n                        } else {\n                            window.console.log('PDF export initiated (no promise returned)');\n                            Toast.add(await getString('export_success', 'mod_bookit'), {type: 'success'});\n                        }\n                    } catch (error) {\n                        window.console.error('Error calling html2pdf:', error);\n                        Toast.add('Export failed: ' + error.message, {type: 'error'});\n                    }\n                } else if (response.detail.downloadurl) {\n                    // Server-side export (TCPDF, CSV, etc.)\n                    window.console.log('Starting server-side export...');\n                    window.open(response.detail.downloadurl, '_blank');\n                    Toast.add(await getString('export_success', 'mod_bookit'), {type: 'success'});\n                } else {\n                    Toast.add(response.detail.message || await getString('export_error', 'mod_bookit'), {type: 'error'});\n                }\n            } else {\n                Toast.add(response.detail.message || await getString('export_error', 'mod_bookit'), {type: 'error'});\n            }\n        });\n\n        modalForm.show();\n    }\n\n    async _handleImportChecklistButtonClick(e) {\n        const masterid = e.target.dataset.masterId;\n\n        const modalForm = new ModalForm({\n            formClass: \"mod_bookit\\\\form\\\\import_checklist_form\",\n            args: {\n                masterid: masterid\n            },\n            modalConfig: {\n                title: await getString('import', 'mod_bookit'),\n            },\n            saveButtonText: await getString('import', 'mod_bookit'),\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, async (response) => {\n            if (response.detail.success) {\n                Toast.add(response.detail.message || await getString('importsuccessful', 'mod_bookit'), {type: 'success'});\n                if (response.detail.reload) {\n                    // Reload the page to show imported data\n                    window.location.reload();\n                }\n            } else {\n                Toast.add(response.detail.message || await getString('importfailed', 'mod_bookit'), {type: 'error'});\n            }\n        });\n\n        modalForm.show();\n    }\n\n    _handleCategoryCreatedEvent(event) {\n\n        if (this.reactive.state.checklistcategories && this.reactive.state.checklistcategories.size > 0) {\n            const noContentElement = this.getElement(this.selectors.NOCONTENT);\n            if (noContentElement) {\n                noContentElement.remove();\n            }\n        }\n\n        Templates.renderForPromise('mod_bookit/bookit_checklist_category',\n            {\n                id: event.element.id,\n                name: event.element.name,\n                order: event.element.order,\n                masterid: 1, // TODO get from state\n                type: 'category',\n            })\n            .then(({html, js}) => {\n                Templates.appendNodeContents(this.getElement(this.selectors.TABLE), html, js);\n            })\n            .then(async () => {\n                Toast.add(await getString('checklistcategorysuccess', 'mod_bookit'),\n                    {type: 'success'});\n\n                if (this.reactive.state.activeRole.id !== 0 || this.reactive.state.activeRoom.id !== 0) {\n                    const components = this.reactive.components;\n                    const categoryResults = this.helper.findComponents(components, {\n                        dataset: {bookitTbodyCategoryId: event.element.id.toString()},\n                        onlyFirst: false\n                    });\n\n                    const categoryComponent = categoryResults.find(comp => typeof comp._handleFilterUpdate === 'function');\n                    categoryComponent._handleFilterUpdate(event);\n                }\n            })\n            .catch(error => {\n                window.console.error('Error rendering checklist item:', error);\n            });\n    }\n\n    _handleItemCreatedEvent(event) {\n\n        window.console.log('HANDLE ITEM CREATED EVENT: ', event);\n\n        const targetElement = this.getElement(`#bookit-master-checklist-tbody-category-${event.element.category}`);\n\n        const roomNames = [];\n        if (event.element.roomnames) {\n            window.console.log('ROOMNAMES: ', event.element.roomnames);\n            event.element.roomnames.forEach((room) => {\n                window.console.log('ROOM: ', room);\n                roomNames.push({\n                    'roomid': room.roomid,\n                    'roomname': room.roomname,\n                    'eventcolor': room.eventcolor,\n                    'textclass': room.textclass,\n                });\n            });\n        }\n\n        const roleNames = [];\n        if (event.element.rolenames) {\n            event.element.rolenames.forEach((role) => {\n                roleNames.push({\n                    'roleid': role.roleid,\n                    'rolename': role.rolename,\n                    'extraclasses': role.extraclasses,\n                });\n            });\n        }\n\n        Templates.renderForPromise('mod_bookit/bookit_checklist_item',\n            {\n                id: event.element.id,\n                title: event.element.title,\n                order: event.element.order,\n                categoryid: event.element.category,\n                roomids: event.element.roomids,\n                roomnames: roomNames,\n                roleids: event.element.roleids,\n                rolenames: roleNames,\n                type: 'item',\n            })\n            .then(({html, js}) => {\n                Templates.appendNodeContents(targetElement, html, js);\n            })\n            .then(async () => {\n                Toast.add(await getString('checklistitemsuccess', 'mod_bookit'),\n                    {type: 'success'});\n                window.console.log('ITEM IS RENDERED');\n\n                // Find and trigger filter update on parent category component\n                const components = this.reactive.components;\n                const categoryResults = this.helper.findComponents(components, {\n                    dataset: {bookitCategoryId: event.element.category},\n                    onlyFirst: true\n                });\n\n                if (categoryResults.length > 0) {\n                    const categoryComponent = categoryResults[0];\n                    if (categoryComponent._handleFilterUpdate) {\n                        categoryComponent._handleFilterUpdate(event);\n                    }\n                }\n            })\n            .catch(error => {\n                window.console.error('Error rendering checklist item:', error);\n            });\n    }\n\n    _handleItemDeletedEvent(event) {\n        const targetElement = this.getElement(`#bookit-master-checklist-item-${event.element.id}`);\n        targetElement.remove();\n\n        Toast.add(getString('checklistitemdeleted', 'mod_bookit', {title: event.element.title}),\n            {type: 'success'});\n    }\n\n    _replaceRenderedItem(event) {\n\n        const actionParts = event.action.split('.');\n        const fieldPart = actionParts[1].split(':')[0];\n\n        if (fieldPart.endsWith('ids')) {\n\n            const stateItem = this.reactive.state.checklistitems.get(event.element.id);\n\n            const selector = `td[data-bookit-checklistitem-tabledata-${fieldPart}-id=\"${event.element.id}\"]`;\n\n            const targetElement = this.getElement(selector);\n            let templateName, templateData;\n\n            if (fieldPart.startsWith('room')) {\n\n                templateName = 'mod_bookit/bookit_checklist_item_rooms';\n                templateData = {\n                    id: event.element.id,\n                    roomnames: stateItem.roomnames\n                };\n            } else if (fieldPart.startsWith('role')) {\n\n                templateName = 'mod_bookit/bookit_checklist_item_roles';\n                templateData = {\n                    id: event.element.id,\n                    rolenames: stateItem.rolenames\n                };\n            } else {\n                return;\n            }\n\n            Templates.renderForPromise(templateName, templateData)\n            .then(({html, js}) => {\n                Templates.replaceNode(targetElement, html, js);\n            })\n            .then(async () => {\n                Toast.add(await getString('checklistitemupdatesuccess', 'mod_bookit'),\n                    {type: 'success'});\n            })\n            .catch(error => {\n                window.console.error('Error rendering checklist item field update:', error);\n            });\n\n        } else {\n            const elementSelector = `span[data-bookit-checklistitem-tabledata-${fieldPart}-id=\"${event.element.id}\"]`;\n\n            const targetElement = this.getElement(elementSelector);\n\n            if (targetElement) {\n                targetElement.innerHTML = event.element[fieldPart];\n            } else {\n                window.console.error('Target element not found for selector:', elementSelector);\n            }\n        }\n\n    }\n\n    _handleCategoryDeletedEvent(event) {\n        const targetElement = this.getElement(`#bookit-master-checklist-tbody-category-${event.element.id}`);\n\n        targetElement.remove();\n\n        Toast.add(getString('checklistcategorydeleted', 'mod_bookit', {name: event.element.name}),\n            {type: 'success'});\n    }\n\n    _handleCategoryNameUpdatedEvent(event) {\n        const targetElement = this.getElement(`#bookit-master-checklist-category-row-${event.element.id}`);\n\n        Templates.renderForPromise('mod_bookit/bookit_checklist_category_row',\n            {\n                id: event.element.id,\n                name: event.element.name,\n                order: event.element.order,\n                type: 'category',\n            })\n            .then(({html, js}) => {\n                Templates.replaceNode(targetElement, html, js);\n\n            })\n            .then(async () => {\n                Toast.add(await getString('checklistcategoryupdatesuccess', 'mod_bookit'),\n                    {type: 'success'});\n                    this.dispatchEvent(this.events.categoryRendered, {\n                        categoryId: event.element.id\n                    });\n            })\n            .catch(error => {\n                window.console.error('Error rendering checklist category:', error);\n            });\n\n    }\n\n\n    _handleRoleUpdate(event) {\n        const allCategoryElements = document.querySelectorAll(this.selectors.ALL_CATEGORY_TABLE_ROWS);\n        allCategoryElements.forEach(categoryElement => {\n\n            const category = this.reactive.state.checklistcategories.get(categoryElement.dataset.bookitCategoryId);\n            const items = [...category.items];\n            var hasVisibleItems = false;\n\n            const activeRoom = this.reactive.state.activeRoom.id;\n\n            items.forEach(itemId => {\n\n                // TODO fix rooms\n\n                const itemElement = document.querySelector(`tr[data-bookit-checklistitem-id=\"${itemId}\"]`);\n\n                if (activeRoom === 0) {\n\n                    if (parseInt(itemElement.dataset.bookitChecklistitemRole) === event.element.id ||  event.element.id === 0) {\n                        itemElement.classList.remove('d-none');\n                        if (!hasVisibleItems) {\n                            hasVisibleItems = true;\n                        }\n                    } else {\n                        itemElement.classList.add('d-none');\n                    }\n                } else if (activeRoom === parseInt(itemElement.dataset.bookitChecklistitemRoom)) {\n\n                    if (parseInt(itemElement.dataset.bookitChecklistitemRole) === event.element.id || event.element.id === 0) {\n                        itemElement.classList.remove('d-none');\n                        if (!hasVisibleItems) {\n                            hasVisibleItems = true;\n                        }\n                    } else {\n                        itemElement.classList.add('d-none');\n                    }\n                } else {\n\n                    itemElement.classList.add('d-none');\n                }\n            });\n\n            if (!hasVisibleItems) {\n                categoryElement.classList.add('d-none');\n            } else {\n                categoryElement.classList.remove('d-none');\n            }\n\n        });\n\n    }\n\n    _handleRoomUpdate(event) {\n\n        const allCategoryElements = document.querySelectorAll(this.selectors.ALL_CATEGORY_TABLE_ROWS);\n        allCategoryElements.forEach(categoryElement => {\n\n            const category = this.reactive.state.checklistcategories.get(categoryElement.dataset.bookitCategoryId);\n\n            const items = [...category.items];\n\n            var hasVisibleItems = false;\n\n            const activeRole = this.reactive.state.activeRole.id;\n\n            // items.forEach(itemId => {\n\n            //     const stateItem = this.reactive.state.checklistitems.get(itemId);\n\n            //     var isInRoom = false;\n\n            //     const roomIds = stateItem.roomids;\n\n            //     if (roomIds.includes(event.element.id.toString())) {\n            //         isInRoom = true;\n            //         window.console.log('ITEM IS IN ROOM: ', itemId);\n            //     } else {\n            //         window.console.log('ITEM IS NOT IN ROOM: ', itemId);\n            //     }\n\n            //     const itemElement = document.querySelector(`tr[data-bookit-checklistitem-id=\"${itemId}\"]`);\n\n            //     if (isInRoom) {\n            //         if (activeRole === 0 || parseInt(itemElement.dataset.bookitChecklistitemRole) === activeRole) {\n            //             itemElement.classList.remove('d-none');\n            //             if (!hasVisibleItems) {\n            //                 hasVisibleItems = true;\n            //             }\n            //         } else {\n            //             itemElement.classList.add('d-none');\n            //         }\n            //     } else {\n\n            //         if (event.element.id === 0 &&\n            //             (parseInt(itemElement.dataset.bookitChecklistitemRole) === activeRole || activeRole === 0)) {\n            //             itemElement.classList.remove('d-none');\n            //             if (!hasVisibleItems) {\n            //                 hasVisibleItems = true;\n            //             }\n            //         } else {\n            //             itemElement.classList.add('d-none');\n            //         }\n            //     }\n            // });\n\n            // if (!hasVisibleItems) {\n            //     categoryElement.classList.add('d-none');\n            // } else {\n            //     categoryElement.classList.remove('d-none');\n            // }\n\n        });\n    }\n\n}"],"names":["BaseComponent","categoryRendered","target","selectors","this","element","document","querySelector","reactive","masterChecklistReactiveInstance","SELECTORS","create","helper","ChecklistHelper","getWatchers","watch","handler","_handleCategoryCreatedEvent","_handleCategoryDeletedEvent","_handleCategoryNameUpdatedEvent","_handleItemCreatedEvent","_handleItemDeletedEvent","_replaceRenderedItem","_handleFilterUpdate","stateReady","state","name","masterchecklists","get","getElement","MASTER_CHECKLIST_TITLE","innerHTML","addEventListener","ADD_CHECKLIST_ITEM_BUTTON","e","preventDefault","_handleAddChecklistItemButtonClick","ADD_CHECKLIST_CATEGORY_BUTTON","_handleAddChecklistCategoryButtonClick","ROLE_SELECT","dispatch","id","value","ROOM_SELECT","window","console","log","options","selectedOptions","EXPORT_BTN","_handleExportChecklistButtonClick","IMPORT_BTN","_handleImportChecklistButtonClick","LOADING_SPINNER","classList","add","mainElement","MAIN_ELEMENT","remove","event","roomSelect","option","selected","modalForm","ModalForm","formClass","args","masterid","itemid","categories","Array","from","checklistcategories","values","modalConfig","title","events","FORM_SUBMITTED","response","detail","show","stateManager","processUpdates","dataset","masterId","saveButtonText","async","success","method","error","Toast","type","length","html2pdf","now","Date","timestamp","getFullYear","String","getMonth","padStart","getDate","getHours","getMinutes","getSeconds","margin","filename","image","quality","html2canvas","scale","useCORS","jsPDF","unit","format","orientation","result","then","catch","message","downloadurl","open","reload","location","size","noContentElement","NOCONTENT","renderForPromise","order","_ref","html","js","appendNodeContents","TABLE","activeRole","activeRoom","components","findComponents","bookitTbodyCategoryId","toString","onlyFirst","find","comp","targetElement","category","roomNames","roomnames","forEach","room","push","roomid","roomname","eventcolor","textclass","roleNames","rolenames","role","roleid","rolename","extraclasses","categoryid","roomids","roleids","_ref2","categoryResults","bookitCategoryId","categoryComponent","fieldPart","action","split","endsWith","stateItem","checklistitems","selector","templateName","templateData","startsWith","_ref3","replaceNode","elementSelector","_ref4","dispatchEvent","categoryId","_handleRoleUpdate","querySelectorAll","ALL_CATEGORY_TABLE_ROWS","categoryElement","items","hasVisibleItems","itemId","itemElement","parseInt","bookitChecklistitemRole","bookitChecklistitemRoom","_handleRoomUpdate"],"mappings":"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"}