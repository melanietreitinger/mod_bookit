{"version":3,"file":"master_checklist.min.js","sources":["../src/master_checklist.js"],"sourcesContent":["import {BaseComponent} from 'core/reactive';\nimport {masterChecklistReactiveInstance} from 'mod_bookit/master_checklist_reactive';\nimport {SELECTORS} from 'mod_bookit/master_checklist_reactive';\nimport ModalForm from 'core_form/modalform';\nimport Templates from 'core/templates';\nimport * as Toast from 'core/toast';\nimport {getString} from 'core/str';\nimport Ajax from 'core/ajax';\nimport ChecklistHelper from 'mod_bookit/checklist_helper';\n\nexport default class extends BaseComponent {\n\n    static getEvents() {\n        return {\n            categoryRendered: 'mod_bookit:master_checklist_category_rendered',\n        };\n    }\n\n    static init(target, selectors) {\n        return new this({\n            element: document.querySelector(target),\n            reactive: masterChecklistReactiveInstance,\n            selectors: selectors || SELECTORS,\n        });\n    }\n\n    create() {\n        this.helper = new ChecklistHelper();\n    }\n\n    getWatchers() {\n        return [\n            {watch: 'checklistcategories:created', handler: this._handleCategoryCreatedEvent},\n            {watch: 'checklistcategories:deleted', handler: this._handleCategoryDeletedEvent},\n            {watch: 'checklistcategories.name:updated', handler: this._handleCategoryNameUpdatedEvent},\n\n            {watch: 'checklistitems:created', handler: this._handleItemCreatedEvent},\n            {watch: 'checklistitems:deleted', handler: this._handleItemDeletedEvent},\n            // {watch: 'checklistitems.categoryid:updated', handler: this._handleItemCategoryUpdatedEvent},\n            {watch: 'checklistitems.title:updated', handler: this._replaceRenderedItem},\n            {watch: 'checklistitems.roomids:updated', handler: this._replaceRenderedItem},\n            {watch: 'checklistitems.roleids:updated', handler: this._replaceRenderedItem},\n            // {watch: 'activeRole:updated', handler: this._handleRoleUpdate},\n            // {watch: 'activeRoom:updated', handler: this._handleRoomUpdate},\n        ];\n    }\n\n    stateReady(state) {\n\n        const name = state.masterchecklists.get(1).name;\n\n        const titleElement = this.getElement(this.selectors.MASTER_CHECKLIST_TITLE);\n\n        titleElement.innerHTML = name;\n\n        this.addEventListener(this.getElement(this.selectors.ADD_CHECKLIST_ITEM_BUTTON), 'click', (e) => {\n            e.preventDefault();\n            this._handleAddChecklistItemButtonClick(e);\n        });\n\n        this.addEventListener(this.getElement(this.selectors.ADD_CHECKLIST_CATEGORY_BUTTON), 'click', (e) => {\n            e.preventDefault();\n            this._handleAddChecklistCategoryButtonClick(e);\n        });\n\n        this.addEventListener(this.getElement(this.selectors.ROLE_SELECT), 'change', (e) => {\n            this.reactive.dispatch('roleChanged', {id: e.target.value});\n        });\n        this.addEventListener(this.getElement(this.selectors.ROOM_SELECT), 'change', (e) => {\n            this.reactive.dispatch('roomChanged', {id: e.target.value});\n        });\n\n        const spinnerElement = document.querySelector(this.selectors.LOADING_SPINNER);\n        spinnerElement.classList.add('d-none');\n\n        const mainElement = document.querySelector(this.selectors.MAIN_ELEMENT);\n        mainElement.classList.remove('d-none');\n\n    }\n\n    async _handleAddChecklistItemButtonClick() {\n        const modalForm = new ModalForm({\n            formClass: \"mod_bookit\\\\form\\\\edit_checklist_item_form\",\n            args: {\n                masterid: 1,\n                itemid: null,\n                categories: Array.from(this.reactive.state.checklistcategories.values()),\n            },\n            modalConfig: {\n                title: await getString('checklistitem', 'mod_bookit'),\n            },\n\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.dispatch('checklistitemCreated', response.detail);\n        });\n\n        modalForm.show();\n    }\n\n\n    async _handleAddChecklistCategoryButtonClick() {\n        const modalForm = new ModalForm({\n            formClass: \"mod_bookit\\\\form\\\\edit_checklist_category_form\",\n            args: {\n                masterid: 1\n            },\n            modalConfig: {\n                title: await getString('checklistcategory', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n\n        });\n\n        modalForm.show();\n    }\n\n    _handleCategoryCreatedEvent(event) {\n\n        Templates.renderForPromise('mod_bookit/bookit_checklist_category',\n            {\n                id: event.element.id,\n                name: event.element.name,\n                order: event.element.order,\n                masterid: 1, // TODO get from state\n                type: 'category',\n            })\n            .then(({html, js}) => {\n                Templates.appendNodeContents(this.getElement(this.selectors.TABLE), html, js);\n            })\n            .then(async () => {\n                Toast.add(await getString('checklistcategorysuccess', 'mod_bookit'),\n                    {type: 'success'});\n\n                if (this.reactive.state.activeRole.id !== 0 || this.reactive.state.activeRoom.id !== 0) {\n                    const components = this.reactive.components;\n                    const categoryResults = this.helper.findComponents(components, {\n                        dataset: {bookitTbodyCategoryId: event.element.id.toString()},\n                        onlyFirst: false\n                    });\n\n                    const categoryComponent = categoryResults.find(comp => typeof comp._handleFilterUpdate === 'function');\n                    categoryComponent._handleFilterUpdate(event);\n                }\n            })\n            .catch(error => {\n                window.console.error('Error rendering checklist item:', error);\n            });\n    }\n\n    _handleItemCreatedEvent(event) {\n\n        window.console.log('HANDLE ITEM CREATED EVENT: ', event);\n\n        const targetElement = this.getElement(`#bookit-master-checklist-tbody-category-${event.element.category}`);\n\n        const roomNames = [];\n        if (event.element.roomnames) {\n            window.console.log('ROOMNAMES: ', event.element.roomnames);\n            event.element.roomnames.forEach((room) => {\n                window.console.log('ROOM: ', room);\n                roomNames.push({\n                    'roomid': room.roomid,\n                    'roomname': room.roomname,\n                    'eventcolor': room.eventcolor,\n                    'textclass': room.textclass,\n                });\n            });\n        }\n\n        const roleNames = [];\n        if (event.element.rolenames) {\n            event.element.rolenames.forEach((role) => {\n                roleNames.push({\n                    'roleid': role.roleid,\n                    'rolename': role.rolename,\n                    'extraclasses': role.extraclasses,\n                });\n            });\n        }\n\n        Templates.renderForPromise('mod_bookit/bookit_checklist_item',\n            {\n                id: event.element.id,\n                title: event.element.title,\n                order: event.element.order,\n                categoryid: event.element.category,\n                roomids: event.element.roomids,\n                roomnames: roomNames,\n                roleids: event.element.roleids,\n                rolenames: roleNames,\n                type: 'item',\n            })\n            .then(({html, js}) => {\n                Templates.appendNodeContents(targetElement, html, js);\n            })\n            .then(async () => {\n                Toast.add(await getString('checklistitemsuccess', 'mod_bookit'),\n                    {type: 'success'});\n                window.console.log('ITEM IS RENDERED');\n\n                // Find and trigger filter update on parent category component\n                const components = this.reactive.components;\n                const categoryResults = this.helper.findComponents(components, {\n                    dataset: {bookitCategoryId: event.element.category},\n                    onlyFirst: true\n                });\n\n                if (categoryResults.length > 0) {\n                    const categoryComponent = categoryResults[0];\n                    if (categoryComponent._handleFilterUpdate) {\n                        categoryComponent._handleFilterUpdate(event);\n                    }\n                }\n            })\n            .catch(error => {\n                window.console.error('Error rendering checklist item:', error);\n            });\n    }\n\n    _handleItemDeletedEvent(event) {\n        const targetElement = this.getElement(`#bookit-master-checklist-item-${event.element.id}`);\n        targetElement.remove();\n\n        Toast.add(getString('checklistitemdeleted', 'mod_bookit', {title: event.element.title}),\n            {type: 'success'});\n    }\n\n    _replaceRenderedItem(event) {\n\n        window.console.log('REPLACING RENDERED ITEM: ', event);\n\n        const actionParts = event.action.split('.');\n        const fieldPart = actionParts[1].split(':')[0];\n\n        if (fieldPart.endsWith('ids')) {\n\n            const stateItem = this.reactive.state.checklistitems.get(event.element.id);\n\n            const selector = `td[data-bookit-checklistitem-tabledata-${fieldPart}-id=\"${event.element.id}\"]`;\n            const targetElement = this.getElement(selector);\n\n            let templateName, templateData;\n\n            if (fieldPart.startsWith('room')) {\n\n                templateName = 'mod_bookit/bookit_checklist_item_rooms';\n                templateData = {\n                    roomnames: stateItem.roomnames\n                };\n                window.console.log('Updating rooms for item:', event.element.id, stateItem.roomnames);\n            } else if (fieldPart.startsWith('role')) {\n\n                templateName = 'mod_bookit/bookit_checklist_item_roles';\n                templateData = {\n                    rolenames: stateItem.rolenames\n                };\n                window.console.log('Updating roles for item:', event.element.id, stateItem.rolenames);\n            } else {\n                window.console.warn('Unknown field type for ids update:', fieldPart);\n                return;\n            }\n\n            Templates.renderForPromise(templateName, templateData)\n            .then(({html, js}) => {\n                Templates.replaceNode(targetElement, html, js);\n            })\n            .then(async () => {\n                Toast.add(await getString('checklistitemupdatesuccess', 'mod_bookit'),\n                    {type: 'success'});\n            })\n            .catch(error => {\n                window.console.error('Error rendering checklist item update:', error);\n            });\n            // var elementString = event.element[fieldPart];\n\n            // let roomIds = [];\n\n            // if (elementString.includes(',')) {\n            //     roomIds = elementString.split(',').map(id => parseInt(id));\n            // } else if (elementString !== '') {\n            //     roomIds = [parseInt(elementString)];\n            // }\n\n            // const roomNames = [];\n            // if (roomIds.length > 0) {\n            //     roomIds.forEach(roomId => {\n            //         if (event.element.roomnames[roomId]) {\n            //             roomNames.push(event.element.roomnames[roomId]);\n            //         }\n            //     });\n            //     // targetElement.innerHTML = roomNames.join(', ');\n            // }\n\n        } else {\n            const elementSelector = `span[data-bookit-checklistitem-tabledata-${fieldPart}-id=\"${event.element.id}\"]`;\n\n            window.console.log('ELEMENT SELECTOR: ', elementSelector);\n\n            const targetElement = this.getElement(elementSelector);\n\n            window.console.log('TARGET ELEMENT: ', targetElement);\n\n            targetElement.innerHTML = event.element[fieldPart];\n\n        }\n\n    }\n\n    _handleCategoryDeletedEvent(event) {\n        const targetElement = this.getElement(`#bookit-master-checklist-tbody-category-${event.element.id}`);\n\n        targetElement.remove();\n\n        Toast.add(getString('checklistcategorydeleted', 'mod_bookit', {name: event.element.name}),\n            {type: 'success'});\n    }\n\n    _handleCategoryNameUpdatedEvent(event) {\n        const targetElement = this.getElement(`#bookit-master-checklist-category-row-${event.element.id}`);\n\n        Templates.renderForPromise('mod_bookit/bookit_checklist_category_row',\n            {\n                id: event.element.id,\n                name: event.element.name,\n                order: event.element.order,\n                type: 'category',\n            })\n            .then(({html, js}) => {\n                Templates.replaceNode(targetElement, html, js);\n\n            })\n            .then(async () => {\n                Toast.add(await getString('checklistcategoryupdatesuccess', 'mod_bookit'),\n                    {type: 'success'});\n                    this.dispatchEvent(this.events.categoryRendered, {\n                        categoryId: event.element.id\n                    });\n            })\n            .catch(error => {\n                window.console.error('Error rendering checklist category:', error);\n            });\n\n    }\n\n\n    _handleRoleUpdate(event) {\n        const allCategoryElements = document.querySelectorAll(this.selectors.ALL_CATEGORY_TABLE_ROWS);\n        allCategoryElements.forEach(categoryElement => {\n\n            const category = this.reactive.state.checklistcategories.get(categoryElement.dataset.bookitCategoryId);\n            const items = [...category.items];\n            var hasVisibleItems = false;\n\n            const activeRoom = this.reactive.state.activeRoom.id;\n\n            items.forEach(itemId => {\n\n                // TODO fix rooms\n\n                const itemElement = document.querySelector(`tr[data-bookit-checklistitem-id=\"${itemId}\"]`);\n\n                if (activeRoom === 0) {\n\n                    if (parseInt(itemElement.dataset.bookitChecklistitemRole) === event.element.id ||  event.element.id === 0) {\n                        itemElement.classList.remove('d-none');\n                        if (!hasVisibleItems) {\n                            hasVisibleItems = true;\n                        }\n                    } else {\n                        itemElement.classList.add('d-none');\n                    }\n                } else if (activeRoom === parseInt(itemElement.dataset.bookitChecklistitemRoom)) {\n\n                    if (parseInt(itemElement.dataset.bookitChecklistitemRole) === event.element.id || event.element.id === 0) {\n                        itemElement.classList.remove('d-none');\n                        if (!hasVisibleItems) {\n                            hasVisibleItems = true;\n                        }\n                    } else {\n                        itemElement.classList.add('d-none');\n                    }\n                } else {\n\n                    itemElement.classList.add('d-none');\n                }\n            });\n\n            if (!hasVisibleItems) {\n                categoryElement.classList.add('d-none');\n            } else {\n                categoryElement.classList.remove('d-none');\n            }\n\n        });\n\n    }\n\n    _handleRoomUpdate(event) {\n\n        const allCategoryElements = document.querySelectorAll(this.selectors.ALL_CATEGORY_TABLE_ROWS);\n        allCategoryElements.forEach(categoryElement => {\n\n            const category = this.reactive.state.checklistcategories.get(categoryElement.dataset.bookitCategoryId);\n\n            const items = [...category.items];\n\n            var hasVisibleItems = false;\n\n            const activeRole = this.reactive.state.activeRole.id;\n\n            // items.forEach(itemId => {\n\n            //     const stateItem = this.reactive.state.checklistitems.get(itemId);\n\n            //     var isInRoom = false;\n\n            //     const roomIds = stateItem.roomids;\n\n            //     if (roomIds.includes(event.element.id.toString())) {\n            //         isInRoom = true;\n            //         window.console.log('ITEM IS IN ROOM: ', itemId);\n            //     } else {\n            //         window.console.log('ITEM IS NOT IN ROOM: ', itemId);\n            //     }\n\n            //     const itemElement = document.querySelector(`tr[data-bookit-checklistitem-id=\"${itemId}\"]`);\n\n            //     if (isInRoom) {\n            //         if (activeRole === 0 || parseInt(itemElement.dataset.bookitChecklistitemRole) === activeRole) {\n            //             itemElement.classList.remove('d-none');\n            //             if (!hasVisibleItems) {\n            //                 hasVisibleItems = true;\n            //             }\n            //         } else {\n            //             itemElement.classList.add('d-none');\n            //         }\n            //     } else {\n\n            //         if (event.element.id === 0 &&\n            //             (parseInt(itemElement.dataset.bookitChecklistitemRole) === activeRole || activeRole === 0)) {\n            //             itemElement.classList.remove('d-none');\n            //             if (!hasVisibleItems) {\n            //                 hasVisibleItems = true;\n            //             }\n            //         } else {\n            //             itemElement.classList.add('d-none');\n            //         }\n            //     }\n            // });\n\n            // if (!hasVisibleItems) {\n            //     categoryElement.classList.add('d-none');\n            // } else {\n            //     categoryElement.classList.remove('d-none');\n            // }\n\n        });\n    }\n\n}"],"names":["BaseComponent","categoryRendered","target","selectors","this","element","document","querySelector","reactive","masterChecklistReactiveInstance","SELECTORS","create","helper","ChecklistHelper","getWatchers","watch","handler","_handleCategoryCreatedEvent","_handleCategoryDeletedEvent","_handleCategoryNameUpdatedEvent","_handleItemCreatedEvent","_handleItemDeletedEvent","_replaceRenderedItem","stateReady","state","name","masterchecklists","get","getElement","MASTER_CHECKLIST_TITLE","innerHTML","addEventListener","ADD_CHECKLIST_ITEM_BUTTON","e","preventDefault","_handleAddChecklistItemButtonClick","ADD_CHECKLIST_CATEGORY_BUTTON","_handleAddChecklistCategoryButtonClick","ROLE_SELECT","dispatch","id","value","ROOM_SELECT","LOADING_SPINNER","classList","add","MAIN_ELEMENT","remove","modalForm","ModalForm","formClass","args","masterid","itemid","categories","Array","from","checklistcategories","values","modalConfig","title","events","FORM_SUBMITTED","response","detail","show","stateManager","processUpdates","event","renderForPromise","order","type","then","_ref","html","js","appendNodeContents","TABLE","async","Toast","activeRole","activeRoom","components","findComponents","dataset","bookitTbodyCategoryId","toString","onlyFirst","find","comp","_handleFilterUpdate","catch","error","window","console","log","targetElement","category","roomNames","roomnames","forEach","room","push","roomid","roomname","eventcolor","textclass","roleNames","rolenames","role","roleid","rolename","extraclasses","categoryid","roomids","roleids","_ref2","categoryResults","bookitCategoryId","length","categoryComponent","fieldPart","action","split","endsWith","stateItem","checklistitems","selector","templateName","templateData","startsWith","warn","_ref3","replaceNode","elementSelector","_ref4","dispatchEvent","categoryId","_handleRoleUpdate","querySelectorAll","ALL_CATEGORY_TABLE_ROWS","categoryElement","items","hasVisibleItems","itemId","itemElement","parseInt","bookitChecklistitemRole","bookitChecklistitemRoom","_handleRoomUpdate"],"mappings":"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"}