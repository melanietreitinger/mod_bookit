define("mod_bookit/possible_slots_refresh",["exports","core/ajax","core/str","core/prefetch"],(function(_exports,Ajax,_str,_prefetch){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initPossibleStarttimesRefresh=
/**
   * Fresh possible slots in the booking form.
   *
   * @module     mod_bookit/possible_slots_refresh
   * @copyright  2025 Justus Dieckmann RUB
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
function initPossibleStarttimesRefresh(){const formEl=document.querySelector(".modal-body form");if(!formEl)return void setTimeout(initPossibleStarttimesRefresh,50);(0,_prefetch.prefetchStrings)("mod_bookit",["no_slot_available","no_weekplan_defined"]);const roomEl=formEl.querySelector('select[name="roomid"]'),durationEl=formEl.querySelector('select[name="duration"]'),dateDayEl=formEl.querySelector('select[name="startdate[day]"]'),dateMonthEl=formEl.querySelector('select[name="startdate[month]"]'),dateYearEl=formEl.querySelector('select[name="startdate[year]"]'),timeEl=formEl.querySelector('select[name="starttime"]'),starttimeEl=document.querySelector('.fitem:has(select[name="starttime"])'),starttimeExplanationEl=document.querySelector('.fitem:has(.form-control-static[data-name="starttime_explanation"])'),starttimeExplanationTextEl=starttimeExplanationEl.querySelector('.form-control-static[data-name="starttime_explanation"]'),refreshStarttimes=async()=>{const year=parseInt(dateYearEl.value),month=parseInt(dateMonthEl.value),day=parseInt(dateDayEl.value),{slots:starttimes,status:status}=await Ajax.call([{methodname:"mod_bookit_get_possible_starttimes",args:{year:year,month:month,day:day,duration:durationEl.value,roomid:roomEl.value}}])[0],currentSelected=new Date(1e3*timeEl.value);for(;timeEl.options.length;)timeEl.options.remove(0);starttimeEl.hidden=null!==status,starttimeExplanationEl.hidden=null===status,null!==status&&(starttimeExplanationTextEl.innerHTML=await(0,_str.getString)(1===status?"no_weekplan_defined":"no_slot_available","mod_bookit"));for(let slot of starttimes){const opt=document.createElement("option");opt.value=slot.timestamp,opt.innerText=slot.string;const date=new Date(1e3*slot.timestamp);60*date.getHours()+date.getMinutes()===60*currentSelected.getHours()+currentSelected.getMinutes()&&(opt.selected=!0),timeEl.options.add(opt)}};for(let el of[roomEl,durationEl,dateDayEl,dateMonthEl,dateYearEl])el.addEventListener("change",refreshStarttimes);refreshStarttimes()},Ajax=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Ajax)}));

//# sourceMappingURL=possible_slots_refresh.min.js.map