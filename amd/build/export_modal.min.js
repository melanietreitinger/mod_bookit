define("mod_bookit/export_modal",["jquery","core/str"],(function($,str){return{init:function(cmId){str.get_strings([{key:"noevents",component:"mod_bookit"},{key:"chooseevent",component:"mod_bookit"}]).done((function(strings){const noEventsStr=strings[0];function toLocalDateValue(dateObj){const d=new Date(dateObj),offMin=d.getTimezoneOffset();return new Date(d.getTime()-6e4*offMin).toISOString().slice(0,10)}function getCalendarDateRangeOrFallback(){if(window.bookitCalendar&&window.bookitCalendar.view){const view=window.bookitCalendar.view;return{startDate:toLocalDateValue(view.activeStart),endDate:toLocalDateValue(new Date(view.activeEnd.getTime()-1))}}return{startDate:"1970-01-01",endDate:"2100-01-01"}}function filterExportList(){const val=($("#bookit-modal-search").val()||"").toLowerCase().trim();$("#bookit-export-list label").each((function(){const $row=$(this),show=$row.text().toLowerCase().includes(val);$row.toggleClass("d-flex",show).toggleClass("d-none",!show)}))}function fetchExportList(){const qs={id:cmId},startDate=($("#bookit-export-start").val()||"").trim(),endDate=($("#bookit-export-end").val()||"").trim(),fallback=getCalendarDateRangeOrFallback(),s=startDate||fallback.startDate,e=endDate||fallback.endDate;qs.start=s+"T00:00",qs.end=e+"T23:59",window.currentFilterParams&&Object.assign(qs,window.currentFilterParams);const list=$("#bookit-export-list");list.html('<div class="text-center p-3"><i class="fa fa-spinner fa-spin"></i></div>'),$.getJSON(M.cfg.wwwroot+"/mod/bookit/events.php",qs,(function(data){if(list.empty(),data=(data||[]).filter((e=>!(e.extendedProps&&(!0===e.extendedProps.reserved||1===e.extendedProps.reserved)))),!data.length)return void list.append('<div class="text-muted">'+noEventsStr+"</div>");const statusMap={0:"New",1:"In progress",2:"Accepted",3:"Cancelled",4:"Rejected"};data.forEach((function(e){var _e$bookingstatus,_e$title;const roomTxt=(e.location||e.room||e.roomname||"").trim(),faculty=(e.department||e.faculty||"").trim(),statusTxt=statusMap[String(null!==(_e$bookingstatus=e.bookingstatus)&&void 0!==_e$bookingstatus?_e$bookingstatus:"")]||"",startStr=e.start||"",dateTxt=startStr?String(startStr).substr(0,16).replace("T"," "):"",metaLine=roomTxt?roomTxt+" "+dateTxt:dateTxt,checkbox='<input class="form-check-input mt-1" type="checkbox" value="'+e.id+'">',row=$('<label class="list-group-item d-flex gap-2 align-items-start"  data-room="'+roomTxt.toLowerCase()+'"  data-faculty="'+faculty.toLowerCase()+'"  data-status="'+statusTxt.toLowerCase()+'">'+checkbox+"<span>"+((null===(_e$title=e.title)||void 0===_e$title?void 0:_e$title.html)||e.title||"")+' <small class="text-muted">('+metaLine+")</small></span></label>");list.append(row)})),filterExportList()})).fail((function(xhr){list.empty(),list.append('<div class="text-danger">events.php failed: '+(xhr.responseText||xhr.status)+"</div>")}))}$(document).on("click","#bookit-export",(function(){const r=getCalendarDateRangeOrFallback();$("#bookit-export-start").val(r.startDate),$("#bookit-export-end").val(r.endDate),$("#bookit-export-modal").modal("show"),fetchExportList()})),$(document).on("change input","#bookit-export-start, #bookit-export-end",(function(){$("#bookit-export-modal").hasClass("show")&&fetchExportList()})),$(document).on("click","#bookit-export-reset-range",(function(){const r=getCalendarDateRangeOrFallback();$("#bookit-export-start").val(r.startDate),$("#bookit-export-end").val(r.endDate),fetchExportList()})),$(document).on("input","#bookit-modal-search",filterExportList),$(document).on("click","#bookit-check-all",(function(){$("#bookit-export-list label:visible input[type=checkbox]:enabled").prop("checked",!0)})),$(document).on("click","#bookit-uncheck-all",(function(){$("#bookit-export-list label:visible input[type=checkbox]:enabled").prop("checked",!1)})),$(document).on("click","#bookit-export-confirm",(function(){const ids=$("#bookit-export-list input[type=checkbox]:enabled:checked").map((function(){return this.value})).get();if(!ids.length)return;const qs=new URLSearchParams({id:cmId});window.currentFilterParams&&Object.entries(window.currentFilterParams).forEach((_ref=>{let[k,v]=_ref;return qs.append(k,v)})),ids.forEach((id=>qs.append("ids[]",id))),window.location=M.cfg.wwwroot+"/mod/bookit/export_events.php?"+qs.toString(),$("#bookit-export-modal").modal("hide")}))}))}}}));

//# sourceMappingURL=export_modal.min.js.map