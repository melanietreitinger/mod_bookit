define("mod_bookit/calendar",["exports","core/str","core_form/modalform","core/prefetch","mod_bookit/possible_slots_refresh"],(function(_exports,_str,_modalform,_prefetch,_possible_slots_refresh){var obj;
/**
   * Manage the calendar
   *
   * @module     mod_bookit/calendar
   * @copyright  2024 Melanie Treitinger, Justus Dieckmann RUB
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=async function(cmid,eventsource,capabilities,lang,config){await theGlobalProperty("EventCalendar");let textcolor="#ffffff";Object.prototype.hasOwnProperty.call(config,"textcolor")&&(textcolor=config.textcolor);let toolbarbuttons="prev,next today";capabilities.addevent&&(toolbarbuttons="prev,next today addButton");await(0,_prefetch.prefetchStrings)("mod_bookit",["addbooking","edit_event"]),await(0,_prefetch.prefetchStrings)("core",["today","month","week"]),await(0,_prefetch.prefetchStrings)("calendar",["day","upcomingevents"]);const strRequestBooking=await(0,_str.getString)("addbooking","mod_bookit"),strToday=await(0,_str.getString)("today"),strMonth=await(0,_str.getString)("month"),strWeek=await(0,_str.getString)("week"),strDay=await(0,_str.getString)("day","calendar"),strList=await(0,_str.getString)("upcomingevents","calendar");let viewType="timeGridWeek";window.screen.width<=1e3&&(viewType="listWeek");const allowedWeekdays=window.M&&M.cfg&&Array.isArray(M.cfg.bookit_allowedweekdays)?M.cfg.bookit_allowedweekdays.map((x=>Number(x))):[1,2,3,4,5],hiddenDays=[0,1,2,3,4,5,6].filter((d=>!allowedWeekdays.includes(d)));let extraFilterParams={};const calendar=new window.EventCalendar(document.getElementById("ec"),{locale:lang,view:viewType,firstDay:1,weekends:allowedWeekdays.includes(0)||allowedWeekdays.includes(6),scrollTime:"09:00:00",slotMinTime:"07:00:00",dayMaxEvents:!0,nowIndicator:!0,hiddenDays:hiddenDays,selectable:!1,eventTextColor:textcolor,eventBackgroundColor:"#035AA3",eventStartEditable:!1,eventDurationEditable:!1,buttonText:function(text){return text.today=strToday,text.dayGridMonth=strMonth,text.timeGridWeek=strWeek,text.timeGridDay=strDay,text.listWeek=strList,text},eventsSet:function(events){events.length},customButtons:{addButton:{text:strRequestBooking,click:function(){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_event_form",args:{cmid:cmid},modalConfig:{title:(0,_str.getString)("edit_event","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{calendar.refetchEvents()})),modalForm.addEventListener(modalForm.events.LOADED,_possible_slots_refresh.initPossibleStarttimesRefresh),modalForm.show()}}},dateClick:function(info){const weekday=info.date.getUTCDay();if(!allowedWeekdays.includes(weekday))return;let d=new Date,dateoff=new Date(d.setMinutes(d.getMinutes()-d.getTimezoneOffset())),startdate=info.dateStr;if(capabilities.addevent&&startdate>dateoff.toISOString()){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_event_form",args:{cmid:cmid,timeclicked:startdate},modalConfig:{title:(0,_str.getString)("edit_event","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{calendar.refetchEvents()})),modalForm.addEventListener(modalForm.events.LOADED,_possible_slots_refresh.initPossibleStarttimesRefresh),modalForm.show()}},eventClick:function(info){let id=info.event.id;if(info.event.extendedProps.reserved)return;const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_event_form",args:{cmid:cmid,id:id},modalConfig:{title:(0,_str.getString)("edit_event","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{calendar.refetchEvents()})),modalForm.addEventListener(modalForm.events.LOADED,_possible_slots_refresh.initPossibleStarttimesRefresh),modalForm.show()},headerToolbar:{start:toolbarbuttons,center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},resources:[],eventSources:[{url:eventsource,extraParams:()=>extraFilterParams}],views:{timeGridWeek:{pointer:!0},resourceTimeGridWeek:{pointer:!0},resourceTimelineWeek:{pointer:!0,slotMinTime:"09:00",slotMaxTime:"21:00",slotWidth:80,resources:[]}}});window.bookitCalendar=calendar,window.bookitCalendarUpdate=function(){let paramObj=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};extraFilterParams=paramObj,window.currentFilterParams=extraFilterParams,calendar.refetchEvents()}},_exports.theGlobalProperty=void 0,_modalform=(obj=_modalform)&&obj.__esModule?obj:{default:obj};const theGlobalProperty=globalPropertyName=>new Promise((resolve=>function loop(){window[globalPropertyName]?resolve():setTimeout(loop,20)}()));_exports.theGlobalProperty=theGlobalProperty}));

//# sourceMappingURL=calendar.min.js.map