{"version":3,"file":"master_checklist_reactive.min.js","sources":["../../src/masterchecklist/master_checklist_reactive.js"],"sourcesContent":["import {Reactive} from 'core/reactive';\r\nimport Mutations from 'mod_bookit/masterchecklist/master_checklist_mutations';\r\n\r\nexport const SELECTORS = {\r\n            TABLE: '#mod-bookit-master-checklist-table',\r\n            MAIN_ELEMENT: '#mod-bookit-master-checklist',\r\n            LOADING_SPINNER: '#mod-bookit-master-checklist-spinner',\r\n            ADD_CHECKLIST_CATEGORY_BUTTON: '#add-checklist-category-button',\r\n            ADD_CHECKLIST_ITEM_BUTTON: '#add-checklist-item-button',\r\n            MASTER_CHECKLIST_TITLE: '#mod-bookit-master-checklist-title',\r\n            ALL_CATEGORY_TABLE_ROWS: 'tr[data-bookit-category-id]',\r\n            ALL_ITEM_TABLE_ROWS: 'tr[data-bookit-checklistitem-id]',\r\n            TABLE_BODY: '#mod-bookit-master-checklist-tbody',\r\n            ALL_ROLE_OPTIONS: 'option[data-bookit-roleoption]',\r\n            ALL_ROOM_OPTIONS: 'option[data-bookit-roomoption]',\r\n            ROLE_SELECT: '#bookit-master-role-select',\r\n            ROOM_SELECT: '#bookit-master-room-select',\r\n            NOCONTENT: '#bookit-master-checklist-nocontent-row',\r\n            EXPORT_BTN: '#export-master-checklist-button',\r\n            IMPORT_BTN: '#import-master-checklist-button',\r\n        };\r\n\r\n\r\nconst EVENTNAME = 'mod_bookit:master_checklist_state_event';\r\n\r\nexport const masterChecklistReactiveInstance = new Reactive({\r\n        eventName: EVENTNAME,\r\n        eventDispatch: dispatchMasterChecklistStateEvent,\r\n        mutations: new Mutations(),\r\n        name: 'Moodle Bookit Master Checklist',\r\n    });\r\n\r\nexport const init = () => {\r\n\r\n    loadState(masterChecklistReactiveInstance);\r\n};\r\n\r\n/**\r\n * Dispatch the master checklist state event.\r\n *\r\n * @param {Object} detail - The event detail.\r\n * @param {HTMLElement} target - The target element.\r\n */\r\nfunction dispatchMasterChecklistStateEvent(detail, target) {\r\n\r\n    if (target === undefined) {\r\n        target = document;\r\n    }\r\n    target.dispatchEvent(\r\n        new CustomEvent(\r\n            EVENTNAME,\r\n            {\r\n                bubbles: true,\r\n                detail: detail,\r\n            }\r\n        )\r\n    );\r\n}\r\n\r\n/**\r\n * Load the initial state.\r\n *\r\n * This iterates over the initial tree of category items, and captures the data required for the state from each category.\r\n * It also captures a count of the number of children in each list.\r\n *\r\n * @param {Reactive} reactive\r\n * @return {Promise<void>}\r\n */\r\nconst loadState = async(reactive) => {\r\n\r\n    const tableElement = document.querySelector(SELECTORS.TABLE);\r\n\r\n    const stateData = {\r\n        masterchecklists: [{\r\n            id: tableElement.dataset.masterChecklistId,\r\n            name: tableElement.dataset.masterChecklistName,\r\n            mastercategoryorder: tableElement.dataset.masterChecklistCategoryorder,\r\n        }],\r\n        activechecklist: {\r\n            id: tableElement.dataset.masterChecklistId,\r\n        },\r\n        checklistcategories: [],\r\n        checklistitems: [],\r\n        roles: [],\r\n        rooms: [],\r\n        activeRole: {\r\n            id: 0,\r\n        },\r\n        activeRoom: [\r\n            {id: 0, name: 'No selection'}\r\n        ],\r\n    };\r\n    const checklistCategoryRows = document.querySelectorAll(SELECTORS.ALL_CATEGORY_TABLE_ROWS);\r\n    checklistCategoryRows.forEach(categoryRow => {\r\n\r\n        const categoryItemRows = document.querySelectorAll(\r\n            `tr[data-bookit-checklistitem-categoryid=\"${categoryRow.dataset.bookitCategoryId}\"]`\r\n        );\r\n\r\n        const checklistItems = [];\r\n        categoryItemRows.forEach(itemRow => {\r\n            checklistItems.push(parseInt(itemRow.dataset.bookitChecklistitemId));\r\n        });\r\n\r\n        stateData.checklistcategories.push({\r\n            id: categoryRow.dataset.bookitCategoryId,\r\n            name: categoryRow.dataset.bookitCategoryName,\r\n            order: categoryRow.dataset.bookitCategoryOrder,\r\n            items: checklistItems\r\n        });\r\n    });\r\n\r\n    const checklistItemRows = document.querySelectorAll(SELECTORS.ALL_ITEM_TABLE_ROWS);\r\n    checklistItemRows.forEach(itemRow => {\r\n        const roomElements = itemRow.querySelectorAll('span[data-bookit-checklistitem-tabledata-room-id]');\r\n        const roleElements = itemRow.querySelectorAll('span[data-bookit-checklistitem-tabledata-role-id]');\r\n\r\n        const roomNames = [];\r\n        roomElements.forEach(roomElement => {\r\n\r\n            // Const itemId = itemRow.dataset.bookitChecklistitemId;\r\n\r\n            roomNames.push({\r\n                'roomid': roomElement.dataset.bookitChecklistitemTabledataRoomId,\r\n                'roomname': roomElement.dataset.bookitChecklistitemRoomname,\r\n                'textclass': roomElement.dataset.bookitChecklistitemTabledataRoomTextclass,\r\n                'eventcolor': roomElement.dataset.bookitChecklistitemTabledataRoomColor\r\n            });\r\n        });\r\n\r\n        const roleNames = [];\r\n        roleElements.forEach(roleElement => {\r\n            roleNames.push({\r\n                'roleid': roleElement.dataset.bookitChecklistitemTabledataRoleId,\r\n                'rolename': roleElement.dataset.bookitChecklistitemRolename\r\n            });\r\n        });\r\n\r\n        stateData.checklistitems.push({\r\n            id: itemRow.dataset.bookitChecklistitemId,\r\n            title: itemRow.dataset.bookitChecklistitemTitle,\r\n            order: itemRow.dataset.bookitChecklistitemOrder,\r\n            categoryid: itemRow.dataset.bookitChecklistitemCategoryid,\r\n            roomids: itemRow.dataset.bookitChecklistitemRoomids,\r\n            roomnames: roomNames,\r\n            roleids: itemRow.dataset.bookitChecklistitemRoleids,\r\n            rolenames: roleNames,\r\n        });\r\n    });\r\n\r\n    // Get all room options\r\n    const roomOptions = document.querySelectorAll(SELECTORS.ALL_ROOM_OPTIONS);\r\n    roomOptions.forEach(roomOption => {\r\n        stateData.rooms.push({\r\n            id: roomOption.value,\r\n            name: roomOption.dataset.bookitRoomname\r\n        });\r\n    });\r\n\r\n    // Get all role options\r\n    const roleOptions = document.querySelectorAll(SELECTORS.ALL_ROLE_OPTIONS);\r\n    roleOptions.forEach(roleOption => {\r\n        stateData.roles.push({\r\n            id: roleOption.value,\r\n            name: roleOption.dataset.bookitRolename\r\n        });\r\n    });\r\n\r\n    reactive.setInitialState(stateData);\r\n};"],"names":["SELECTORS","TABLE","MAIN_ELEMENT","LOADING_SPINNER","ADD_CHECKLIST_CATEGORY_BUTTON","ADD_CHECKLIST_ITEM_BUTTON","MASTER_CHECKLIST_TITLE","ALL_CATEGORY_TABLE_ROWS","ALL_ITEM_TABLE_ROWS","TABLE_BODY","ALL_ROLE_OPTIONS","ALL_ROOM_OPTIONS","ROLE_SELECT","ROOM_SELECT","NOCONTENT","EXPORT_BTN","IMPORT_BTN","EVENTNAME","masterChecklistReactiveInstance","Reactive","eventName","eventDispatch","detail","target","undefined","document","dispatchEvent","CustomEvent","bubbles","mutations","Mutations","name","loadState","async","tableElement","querySelector","stateData","masterchecklists","id","dataset","masterChecklistId","masterChecklistName","mastercategoryorder","masterChecklistCategoryorder","activechecklist","checklistcategories","checklistitems","roles","rooms","activeRole","activeRoom","querySelectorAll","forEach","categoryRow","categoryItemRows","bookitCategoryId","checklistItems","itemRow","push","parseInt","bookitChecklistitemId","bookitCategoryName","order","bookitCategoryOrder","items","roomElements","roleElements","roomNames","roomElement","bookitChecklistitemTabledataRoomId","bookitChecklistitemRoomname","bookitChecklistitemTabledataRoomTextclass","bookitChecklistitemTabledataRoomColor","roleNames","roleElement","bookitChecklistitemTabledataRoleId","bookitChecklistitemRolename","title","bookitChecklistitemTitle","bookitChecklistitemOrder","categoryid","bookitChecklistitemCategoryid","roomids","bookitChecklistitemRoomids","roomnames","roleids","bookitChecklistitemRoleids","rolenames","roomOption","value","bookitRoomname","roleOption","bookitRolename","reactive","setInitialState"],"mappings":"mcAGaA,UAAY,CACbC,MAAO,qCACPC,aAAc,+BACdC,gBAAiB,uCACjBC,8BAA+B,iCAC/BC,0BAA2B,6BAC3BC,uBAAwB,qCACxBC,wBAAyB,8BACzBC,oBAAqB,mCACrBC,WAAY,qCACZC,iBAAkB,iCAClBC,iBAAkB,iCAClBC,YAAa,6BACbC,YAAa,6BACbC,UAAW,yCACXC,WAAY,kCACZC,WAAY,sEAIlBC,UAAY,0CAELC,gCAAkC,IAAIC,mBAAS,CACpDC,UAAWH,UACXI,uBAgBmCC,OAAQC,aAEhCC,IAAXD,SACAA,OAASE,UAEbF,OAAOG,cACH,IAAIC,YACAV,UACA,CACIW,SAAS,EACTN,OAAQA,WAzBhBO,UAAW,IAAIC,oCACfC,KAAM,0HAGM,KAEhBC,UAAUd,wCAkCRc,UAAYC,MAAAA,iBAERC,aAAeT,SAASU,cAAcnC,UAAUC,OAEhDmC,UAAY,CACdC,iBAAkB,CAAC,CACfC,GAAIJ,aAAaK,QAAQC,kBACzBT,KAAMG,aAAaK,QAAQE,oBAC3BC,oBAAqBR,aAAaK,QAAQI,+BAE9CC,gBAAiB,CACbN,GAAIJ,aAAaK,QAAQC,mBAE7BK,oBAAqB,GACrBC,eAAgB,GAChBC,MAAO,GACPC,MAAO,GACPC,WAAY,CACRX,GAAI,GAERY,WAAY,CACR,CAACZ,GAAI,EAAGP,KAAM,kBAGQN,SAAS0B,iBAAiBnD,UAAUO,yBAC5C6C,SAAQC,oBAEpBC,iBAAmB7B,SAAS0B,oEACcE,YAAYd,QAAQgB,wBAG9DC,eAAiB,GACvBF,iBAAiBF,SAAQK,UACrBD,eAAeE,KAAKC,SAASF,QAAQlB,QAAQqB,2BAGjDxB,UAAUS,oBAAoBa,KAAK,CAC/BpB,GAAIe,YAAYd,QAAQgB,iBACxBxB,KAAMsB,YAAYd,QAAQsB,mBAC1BC,MAAOT,YAAYd,QAAQwB,oBAC3BC,MAAOR,oBAIW/B,SAAS0B,iBAAiBnD,UAAUQ,qBAC5C4C,SAAQK,gBAChBQ,aAAeR,QAAQN,iBAAiB,qDACxCe,aAAeT,QAAQN,iBAAiB,qDAExCgB,UAAY,GAClBF,aAAab,SAAQgB,cAIjBD,UAAUT,KAAK,QACDU,YAAY7B,QAAQ8B,4CAClBD,YAAY7B,QAAQ+B,sCACnBF,YAAY7B,QAAQgC,qDACnBH,YAAY7B,QAAQiC,iDAIpCC,UAAY,GAClBP,aAAad,SAAQsB,cACjBD,UAAUf,KAAK,QACDgB,YAAYnC,QAAQoC,4CAClBD,YAAYnC,QAAQqC,iCAIxCxC,UAAUU,eAAeY,KAAK,CAC1BpB,GAAImB,QAAQlB,QAAQqB,sBACpBiB,MAAOpB,QAAQlB,QAAQuC,yBACvBhB,MAAOL,QAAQlB,QAAQwC,yBACvBC,WAAYvB,QAAQlB,QAAQ0C,8BAC5BC,QAASzB,QAAQlB,QAAQ4C,2BACzBC,UAAWjB,UACXkB,QAAS5B,QAAQlB,QAAQ+C,2BACzBC,UAAWd,eAKChD,SAAS0B,iBAAiBnD,UAAUW,kBAC5CyC,SAAQoC,aAChBpD,UAAUY,MAAMU,KAAK,CACjBpB,GAAIkD,WAAWC,MACf1D,KAAMyD,WAAWjD,QAAQmD,oBAKbjE,SAAS0B,iBAAiBnD,UAAUU,kBAC5C0C,SAAQuC,aAChBvD,UAAUW,MAAMW,KAAK,CACjBpB,GAAIqD,WAAWF,MACf1D,KAAM4D,WAAWpD,QAAQqD,oBAIjCC,SAASC,gBAAgB1D"}