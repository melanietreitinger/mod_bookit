define("mod_bookit/masterchecklist/master_checklist_category",["exports","core/reactive","mod_bookit/masterchecklist/master_checklist_reactive","core_form/modalform","core/str","mod_bookit/helpers/checklist_helper","core/notification"],(function(_exports,_reactive,_master_checklist_reactive,_modalform,_str,_checklist_helper,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modalform=_interopRequireDefault(_modalform),_checklist_helper=_interopRequireDefault(_checklist_helper),_notification=_interopRequireDefault(_notification);class _default extends _reactive.BaseComponent{create(descriptor){this.helper=new _checklist_helper.default;const categoryEditBtnSelector="EDIT_CHECKLISTCATEGORY_BTN_"+descriptor.element.dataset.bookitCategoryId;this.selectors[categoryEditBtnSelector]=`#edit-checklistcategory-${descriptor.element.dataset.bookitCategoryId}`;const categoryTbodySelector="CATEGORY_TBODY_"+descriptor.element.dataset.bookitCategoryId;this.selectors[categoryTbodySelector]=`#bookit-master-checklist-tbody-category-${descriptor.element.dataset.bookitCategoryId}`}static init(target,selectors){return new this({element:document.querySelector(target),reactive:_master_checklist_reactive.masterChecklistReactiveInstance,selectors:selectors||_master_checklist_reactive.SELECTORS})}getWatchers(){return[{watch:"checklistcategories.name:updated",handler:this._refreshEditButtonListener},{watch:"activeRole:updated",handler:this._handleFilterUpdate},{watch:"activeRoom:created",handler:this._handleFilterUpdate},{watch:"checklistitems:created",handler:this._handleFilterUpdate},{watch:"checklistitems.roomids:updated",handler:this._handleFilterUpdate},{watch:"checklistitems.roleids:updated",handler:this._handleFilterUpdate}]}stateReady(){this.dragdrop=new _reactive.DragDrop(this);const categoryEditBtnSelector="EDIT_CHECKLISTCATEGORY_BTN_"+this.element.dataset.bookitCategoryId;this.addEventListener(this.getElement(this.selectors[categoryEditBtnSelector]),"click",(e=>{e.preventDefault(),this._handleEditChecklistCategoryButtonClick(e)})),document.addEventListener("mod_bookit:master_checklist_category_rendered",(e=>{this._refreshEditButtonListener(e)}),!0)}destroy(){void 0!==this.dragdrop&&this.dragdrop.unregister()}validateDropData(){return!0}async _handleEditChecklistCategoryButtonClick(){const modalForm=new _modalform.default({formClass:"mod_bookit\\local\\form\\masterchecklist\\edit_checklist_category_form",moduleName:"mod_bookit/modal_delete_save_cancel",args:{id:this.element.dataset.bookitCategoryId,masterid:1,checklistitems:JSON.stringify(this.reactive.state.checklistcategories.get(this.element.dataset.bookitCategoryId).items)},modalConfig:{title:await(0,_str.getString)("checklistcategory","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(response=>{this.reactive.stateManager.processUpdates(response.detail)})),modalForm.addEventListener(modalForm.events.LOADED,(()=>{modalForm.modal.getRoot().find('button[data-action="delete"]').on("click",(async e=>{e.preventDefault();const confirmTitle=await(0,_str.getString)("confirm","core"),confirmMessage=await(0,_str.getString)("areyousure","core"),deleteText=await(0,_str.getString)("delete","core");_notification.default.deleteCancel(confirmTitle,confirmMessage,deleteText,(()=>{modalForm.getFormNode().querySelector('input[name="action"]').value="delete",modalForm.submitFormAjax()}))}))})),modalForm.show()}_refreshEditButtonListener(){this.removeAllEventListeners();const categoryEditBtnSelector="EDIT_CHECKLISTCATEGORY_BTN_"+this.element.dataset.bookitCategoryId;this.addEventListener(this.getElement(this.selectors[categoryEditBtnSelector]),"click",(e=>{e.preventDefault(),this._handleEditChecklistCategoryButtonClick(e)}))}drop(dropdata){switch(dropdata.type){case"item":this._handleItemDrop(dropdata);break;case"category":this._handleCategoryDrop(dropdata);break;default:throw new Error(`Unknown drop type: ${dropdata.type}`)}}showDropZone(){const root=document.querySelector("html"),primaryColor=getComputedStyle(root).getPropertyValue("--primary");this.element.style.boxShadow=`0px -5px 0px 0px ${primaryColor} inset`,this.element.style.transition="box-shadow 0.1s ease"}hideDropZone(){this.element.style.boxShadow="",this.element.style.backgroundBlendMode="",this.element.style.transition=""}_handleItemDrop(dropdata){const categoryObjectItems=[...this.reactive.state.checklistcategories.get(this.element.dataset.bookitCategoryId).items],lastItemId=categoryObjectItems[categoryObjectItems.length-1];dropdata.targetId=parseInt(lastItemId),dropdata.targetParentId=parseInt(this.element.dataset.bookitCategoryId),this.reactive.dispatch("reOrderCategoryItems",dropdata);const itemObject=this.reactive.state.checklistitems.get(dropdata.id),itemElement=document.getElementById(`bookit-master-checklist-item-${itemObject.id}`);dropdata.parentId!==dropdata.targetParentId&&(itemElement.dataset.bookitChecklistitemCategoryid=dropdata.targetParentId),this.element.append(itemElement)}_handleCategoryDrop(dropdata){dropdata.targetId=parseInt(this.element.dataset.bookitCategoryId),dropdata.targetParentId=parseInt(this.element.dataset.bookitCategoryMasterid),this.reactive.dispatch("reOrderCategories",dropdata);const categoryObject=this.reactive.state.checklistcategories.get(dropdata.id),categoryElement=document.getElementById(`bookit-master-checklist-tbody-category-${categoryObject.id}`);document.querySelector(this.selectors.TABLE).insertBefore(categoryElement,this.element.nextElementSibling)}_handleFilterUpdate(){const components=this.reactive.components,results=this.helper.findComponents(components,{dataset:{bookitChecklistitemCategoryid:this.element.dataset.bookitCategoryId},onlyFirst:!1});if(results&&0!==results.length){var hasVisibleItems=!1;results.forEach((component=>{component.shouldBeVisible()&&(hasVisibleItems=!0)})),hasVisibleItems?this.element.classList.remove("d-none"):this.element.classList.add("d-none")}else{const activeRooms=this.reactive.state.activeRoom,activeRoleId=this.reactive.state.activeRole.id,noRoomSelection=activeRooms.some((room=>0==room.id));0==activeRoleId&&noRoomSelection&&this.element.classList.remove("d-none")}}}return _exports.default=_default,_exports.default}));

//# sourceMappingURL=master_checklist_category.min.js.map