{"version":3,"file":"possible_slots_refresh.min.js","sources":["../src/possible_slots_refresh.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Fresh possible slots in the booking form.\n *\n * @module     mod_bookit/possible_slots_refresh\n * @copyright  2025 Justus Dieckmann RUB\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Ajax from 'core/ajax';\n\n/**\n * Initializes the calendar.\n */\nexport function initPossibleStarttimesRefresh() {\n    const formEl = document.querySelector('.modal-body form');\n    if (!formEl) {\n        setTimeout(initPossibleStarttimesRefresh, 50);\n        return;\n    }\n\n    const roomEl = formEl.querySelector('select[name=\"roomid\"]');\n    const durationEl = formEl.querySelector('select[name=\"duration\"]');\n    const dateDayEl = formEl.querySelector('select[name=\"startdate[day]\"]');\n    const dateMonthEl = formEl.querySelector('select[name=\"startdate[month]\"]');\n    const dateYearEl = formEl.querySelector('select[name=\"startdate[year]\"]');\n\n    const timeEl = formEl.querySelector('select[name=\"starttime\"]');\n\n    const refreshStarttimes = async() => {\n        const year = parseInt(dateYearEl.value);\n        const month = parseInt(dateMonthEl.value);\n        const day = parseInt(dateDayEl.value);\n\n        const starttimes = await Ajax.call([{\n            methodname: 'mod_bookit_get_possible_starttimes',\n            args: {\n                year: year,\n                month: month,\n                day: day,\n                duration: durationEl.value,\n                roomid: roomEl.value,\n            }\n        }])[0];\n\n        const currentSelected = new Date(timeEl.value * 1000);\n\n        while (timeEl.options.length) {\n            timeEl.options.remove(0);\n        }\n\n        for (let slot of starttimes) {\n            const opt = document.createElement(\"option\");\n            opt.value = slot.timestamp;\n            opt.innerText = slot.string;\n            const date = new Date(slot.timestamp * 1000);\n            if (date.getHours() * 60 + date.getMinutes() === currentSelected.getHours() * 60 + currentSelected.getMinutes()) {\n                opt.selected = true;\n            }\n            timeEl.options.add(opt);\n        }\n    };\n\n    for (let el of [roomEl, durationEl, dateDayEl, dateMonthEl, dateYearEl]) {\n        el.addEventListener('change', refreshStarttimes);\n    }\n}\n"],"names":["initPossibleStarttimesRefresh","formEl","document","querySelector","setTimeout","roomEl","durationEl","dateDayEl","dateMonthEl","dateYearEl","timeEl","refreshStarttimes","async","year","parseInt","value","month","day","starttimes","Ajax","call","methodname","args","duration","roomid","currentSelected","Date","options","length","remove","slot","opt","createElement","timestamp","innerText","string","date","getHours","getMinutes","selected","add","el","addEventListener"],"mappings":";;;;;;;;SA4BgBA,sCACNC,OAASC,SAASC,cAAc,wBACjCF,mBACDG,WAAWJ,8BAA+B,UAIxCK,OAASJ,OAAOE,cAAc,yBAC9BG,WAAaL,OAAOE,cAAc,2BAClCI,UAAYN,OAAOE,cAAc,iCACjCK,YAAcP,OAAOE,cAAc,mCACnCM,WAAaR,OAAOE,cAAc,kCAElCO,OAAST,OAAOE,cAAc,4BAE9BQ,kBAAoBC,gBAChBC,KAAOC,SAASL,WAAWM,OAC3BC,MAAQF,SAASN,YAAYO,OAC7BE,IAAMH,SAASP,UAAUQ,OAEzBG,iBAAmBC,KAAKC,KAAK,CAAC,CAChCC,WAAY,qCACZC,KAAM,CACFT,KAAMA,KACNG,MAAOA,MACPC,IAAKA,IACLM,SAAUjB,WAAWS,MACrBS,OAAQnB,OAAOU,UAEnB,GAEEU,gBAAkB,IAAIC,KAAoB,IAAfhB,OAAOK,YAEjCL,OAAOiB,QAAQC,QAClBlB,OAAOiB,QAAQE,OAAO,OAGrB,IAAIC,QAAQZ,WAAY,OACnBa,IAAM7B,SAAS8B,cAAc,UACnCD,IAAIhB,MAAQe,KAAKG,UACjBF,IAAIG,UAAYJ,KAAKK,aACfC,KAAO,IAAIV,KAAsB,IAAjBI,KAAKG,WACL,GAAlBG,KAAKC,WAAkBD,KAAKE,eAA8C,GAA7Bb,gBAAgBY,WAAkBZ,gBAAgBa,eAC/FP,IAAIQ,UAAW,GAEnB7B,OAAOiB,QAAQa,IAAIT,WAItB,IAAIU,KAAM,CAACpC,OAAQC,WAAYC,UAAWC,YAAaC,YACxDgC,GAAGC,iBAAiB,SAAU/B"}