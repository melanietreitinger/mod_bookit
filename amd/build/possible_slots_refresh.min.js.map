{"version":3,"file":"possible_slots_refresh.min.js","sources":["../src/possible_slots_refresh.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Fresh possible slots in the booking form.\r\n *\r\n * @module     mod_bookit/possible_slots_refresh\r\n * @copyright  2025 Justus Dieckmann RUB\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport * as Ajax from 'core/ajax';\r\n\r\n/**\r\n * Initializes the calendar.\r\n */\r\nexport function initPossibleStarttimesRefresh() {\r\n    const formEl = document.querySelector('.modal-body form');\r\n    if (!formEl) {\r\n        setTimeout(initPossibleStarttimesRefresh, 50);\r\n        return;\r\n    }\r\n\r\n    const roomEl = formEl.querySelector('select[name=\"roomid\"]');\r\n    const durationEl = formEl.querySelector('select[name=\"duration\"]');\r\n    const dateDayEl = formEl.querySelector('select[name=\"startdate[day]\"]');\r\n    const dateMonthEl = formEl.querySelector('select[name=\"startdate[month]\"]');\r\n    const dateYearEl = formEl.querySelector('select[name=\"startdate[year]\"]');\r\n\r\n    const timeEl = formEl.querySelector('select[name=\"starttime\"]');\r\n\r\n    const refreshStarttimes = async() => {\r\n        const year = parseInt(dateYearEl.value);\r\n        const month = parseInt(dateMonthEl.value);\r\n        const day = parseInt(dateDayEl.value);\r\n\r\n        const starttimes = await Ajax.call([{\r\n            methodname: 'mod_bookit_get_possible_starttimes',\r\n            args: {\r\n                year: year,\r\n                month: month,\r\n                day: day,\r\n                duration: durationEl.value,\r\n                roomid: roomEl.value,\r\n            }\r\n        }])[0];\r\n\r\n        const currentSelected = new Date(timeEl.value * 1000);\r\n\r\n        while (timeEl.options.length) {\r\n            timeEl.options.remove(0);\r\n        }\r\n\r\n        for (let slot of starttimes) {\r\n            const opt = document.createElement(\"option\");\r\n            opt.value = slot.timestamp;\r\n            opt.innerText = slot.string;\r\n            const date = new Date(slot.timestamp * 1000);\r\n            if (date.getHours() * 60 + date.getMinutes() === currentSelected.getHours() * 60 + currentSelected.getMinutes()) {\r\n                opt.selected = true;\r\n            }\r\n            timeEl.options.add(opt);\r\n        }\r\n    };\r\n\r\n    for (let el of [roomEl, durationEl, dateDayEl, dateMonthEl, dateYearEl]) {\r\n        el.addEventListener('change', refreshStarttimes);\r\n    }\r\n    void refreshStarttimes();\r\n}\r\n"],"names":["initPossibleStarttimesRefresh","formEl","document","querySelector","setTimeout","roomEl","durationEl","dateDayEl","dateMonthEl","dateYearEl","timeEl","refreshStarttimes","async","year","parseInt","value","month","day","starttimes","Ajax","call","methodname","args","duration","roomid","currentSelected","Date","options","length","remove","slot","opt","createElement","timestamp","innerText","string","date","getHours","getMinutes","selected","add","el","addEventListener"],"mappings":";;;;;;;;SA4BgBA,sCACNC,OAASC,SAASC,cAAc,wBACjCF,mBACDG,WAAWJ,8BAA+B,UAIxCK,OAASJ,OAAOE,cAAc,yBAC9BG,WAAaL,OAAOE,cAAc,2BAClCI,UAAYN,OAAOE,cAAc,iCACjCK,YAAcP,OAAOE,cAAc,mCACnCM,WAAaR,OAAOE,cAAc,kCAElCO,OAAST,OAAOE,cAAc,4BAE9BQ,kBAAoBC,gBAChBC,KAAOC,SAASL,WAAWM,OAC3BC,MAAQF,SAASN,YAAYO,OAC7BE,IAAMH,SAASP,UAAUQ,OAEzBG,iBAAmBC,KAAKC,KAAK,CAAC,CAChCC,WAAY,qCACZC,KAAM,CACFT,KAAMA,KACNG,MAAOA,MACPC,IAAKA,IACLM,SAAUjB,WAAWS,MACrBS,OAAQnB,OAAOU,UAEnB,GAEEU,gBAAkB,IAAIC,KAAoB,IAAfhB,OAAOK,YAEjCL,OAAOiB,QAAQC,QAClBlB,OAAOiB,QAAQE,OAAO,OAGrB,IAAIC,QAAQZ,WAAY,OACnBa,IAAM7B,SAAS8B,cAAc,UACnCD,IAAIhB,MAAQe,KAAKG,UACjBF,IAAIG,UAAYJ,KAAKK,aACfC,KAAO,IAAIV,KAAsB,IAAjBI,KAAKG,WACL,GAAlBG,KAAKC,WAAkBD,KAAKE,eAA8C,GAA7Bb,gBAAgBY,WAAkBZ,gBAAgBa,eAC/FP,IAAIQ,UAAW,GAEnB7B,OAAOiB,QAAQa,IAAIT,WAItB,IAAIU,KAAM,CAACpC,OAAQC,WAAYC,UAAWC,YAAaC,YACxDgC,GAAGC,iBAAiB,SAAU/B,mBAE7BA"}