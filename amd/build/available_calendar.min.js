define("mod_bookit/available_calendar",["exports","core/ajax","core/str","core/modal_events","core_form/modalform","core/prefetch","mod_bookit/calendar"],(function(_exports,Ajax,_str,_modal_events,_modalform,_prefetch,_calendar){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=
/**
   * Manage the calendar
   *
   * @module     mod_bookit/available_calendar
   * @copyright  2024 Melanie Treitinger, Justus Dieckmann RUB
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
async function(eventsource,capabilities,lang){await(0,_calendar.theGlobalProperty)("EventCalendar");(0,_prefetch.prefetchStrings)("mod_bookit",["add_blocker"]),(0,_prefetch.prefetchStrings)("core",["today","month","week"]),(0,_prefetch.prefetchStrings)("calendar",["day","upcomingevents"]);const str_request_booking=await(0,_str.getString)("add_blocker","mod_bookit"),str_today=await(0,_str.getString)("today"),str_month=await(0,_str.getString)("month"),str_week=await(0,_str.getString)("week"),str_day=await(0,_str.getString)("day","calendar"),str_list=await(0,_str.getString)("upcomingevents","calendar");let viewType="timeGridWeek";window.screen.width<=1e3&&(viewType="listWeek");var calendar;calendar=new window.EventCalendar(document.getElementById("ec"),{locale:lang,view:viewType,firstDay:1,scrollTime:"09:00:00",slotMinTime:"07:00:00",dayMaxEvents:!0,nowIndicator:!0,selectable:!1,eventBackgroundColor:"#035AA3",eventStartEditable:!1,eventDurationEditable:!1,buttonText:function(text){return text.today=str_today,text.dayGridMonth=str_month,text.timeGridWeek=str_week,text.timeGridDay=str_day,text.listWeek=str_list,text},customButtons:{addButton:{text:str_request_booking,click:function(){const modalForm=new _modalform.default({formClass:"mod_bookit\\local\\form\\edit_blocker_form",args:{},modalConfig:{title:(0,_str.getString)("add_blocker","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{calendar.refetchEvents()})),modalForm.show()}}},dateClick:function(info){let d=new Date,dateoff=new Date(d.setMinutes(d.getMinutes()-d.getTimezoneOffset())),startdate=info.dateStr;if(startdate>dateoff.toISOString()){const modalForm=new _modalform.default({formClass:"mod_bookit\\local\\form\\edit_blocker_form",args:{startdate:startdate},modalConfig:{title:(0,_str.getString)("add_blocker","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{calendar.refetchEvents()})),modalForm.show()}},eventClick:function(info){if("blocker"===info.event.extendedProps.type){const modalForm=new _modalform.default({formClass:"mod_bookit\\local\\form\\edit_blocker_form",args:{id:info.event.id},modalConfig:{title:(0,_str.getString)("edit_blocker","mod_bookit")},moduleName:"mod_bookit/modal_delete_save_cancel"});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{calendar.refetchEvents()})),modalForm.addEventListener(modalForm.events.LOADED,(()=>{modalForm.modal.getRoot().on(_modal_events.default.delete,(async()=>{var blockerId;await(blockerId=info.event.id,Ajax.call([{methodname:"mod_bookit_delete_blocker",args:{blockerid:blockerId}}])[0]),calendar.refetchEvents()}))})),modalForm.show()}},headerToolbar:{start:"prev, next, today, addButton",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},resources:[],eventSources:[{url:eventsource}],views:{timeGridWeek:{pointer:!0},resourceTimeGridWeek:{pointer:!0},resourceTimelineWeek:{pointer:!0,slotMinTime:"09:00",slotMaxTime:"21:00",slotWidth:80,resources:[]}}})},Ajax=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Ajax),_modal_events=_interopRequireDefault(_modal_events),_modalform=_interopRequireDefault(_modalform)}));

//# sourceMappingURL=available_calendar.min.js.map